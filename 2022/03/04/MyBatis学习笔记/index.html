<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico">
  <link rel="mask-icon" href="/images/favicon.ico" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|EB Garamond:300,300italic,400,400italic,700,700italic|Source Code Pro:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"aeowind.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="小楼一夜听春雨，深巷明朝卖杏花。矮纸斜行闲作草，晴窗细乳戏分茶。">
<meta property="og:type" content="article">
<meta property="og:title" content="MyBatis学习笔记">
<meta property="og:url" content="https://aeowind.github.io/2022/03/04/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="Aeo&#39;s Blog">
<meta property="og:description" content="小楼一夜听春雨，深巷明朝卖杏花。矮纸斜行闲作草，晴窗细乳戏分茶。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://z3.ax1x.com/2021/06/02/2lEC0s.png">
<meta property="og:image" content="https://z3.ax1x.com/2021/06/02/2lEZ1U.png">
<meta property="article:published_time" content="2022-03-04T12:46:25.422Z">
<meta property="article:modified_time" content="2021-08-23T11:56:15.965Z">
<meta property="article:author" content="aeowind">
<meta property="article:tag" content="学习">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="工具">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://z3.ax1x.com/2021/06/02/2lEC0s.png">

<link rel="canonical" href="https://aeowind.github.io/2022/03/04/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>MyBatis学习笔记 | Aeo's Blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Aeo's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">你要静候 再静候</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://aeowind.github.io/2022/03/04/MyBatis%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="aeowind">
      <meta itemprop="description" content="爱上一场认真的消遣">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Aeo's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          MyBatis学习笔记
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-03-04 20:46:25" itemprop="dateCreated datePublished" datetime="2022-03-04T20:46:25+08:00">2022-03-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-08-23 19:56:15" itemprop="dateModified" datetime="2021-08-23T19:56:15+08:00">2021-08-23</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">学习</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AD%A6%E4%B9%A0/Java/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
            </span>

          
            <div class="post-description"><blockquote class="blockquote-center">小楼一夜听春雨，深巷明朝卖杏花。矮纸斜行闲作草，晴窗细乳戏分茶。</blockquote></div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="MyBatis"><a href="#MyBatis" class="headerlink" title="MyBatis"></a>MyBatis</h1><h2 id="对原生jdbc程序中的问题总结"><a href="#对原生jdbc程序中的问题总结" class="headerlink" title="对原生jdbc程序中的问题总结"></a>对原生jdbc程序中的问题总结</h2><h3 id="jdbc编程步骤"><a href="#jdbc编程步骤" class="headerlink" title="jdbc编程步骤"></a>jdbc编程步骤</h3><ol>
<li><p>加载数据库驱动</p>
</li>
<li><p>创建并获取数据库链接</p>
</li>
<li><p>创建jdbc statement对象</p>
</li>
<li><p>设置sql语句</p>
</li>
<li><p>设置sql语句中的参数(使用preparedStatement)</p>
</li>
<li><p>通过statement执行sql并获取结果</p>
</li>
<li><p>对sql执行结果进行解析处理</p>
</li>
<li><p>释放资源(resultSet、preparedstatement、connection)</p>
</li>
</ol>
<h3 id="问题总结"><a href="#问题总结" class="headerlink" title="问题总结"></a>问题总结</h3><ol>
<li>数据库连接，使用时就创建，不使用立即释放，对数据库进行频繁连接开启和关闭，造成数据库资源浪费，影响数据库性能。</li>
</ol>
<p><em><strong>设想</strong></em>：使用数据库连接池管理数据库连接。</p>
<ol start="2">
<li>将sql语句硬编码到java代码中，如果sql语句修改，需要重新编译java代码，不利于系统维护。</li>
</ol>
<p><em><strong>设想</strong></em>：将sql语句配置在xml配置文件中，即使sql变化，不需要对java代码进行重新编译。</p>
<ol start="3">
<li>向<code>preparedStatement</code>中设置参数，对占位符号位置和设置参数值，硬编码在java代码中，不利于系统维护。</li>
</ol>
<p><em><strong>设想</strong></em>：将sql语句及占位符号和参数全部配置在xml中。</p>
<p>4.从<code>resutSet</code>中遍历结果集数据时，存在硬编码，将获取表的字段进行硬编码，不利于系统维护。</p>
<p><em><strong>设想</strong></em>：将查询的结果集，<strong>自动映射成java对象</strong>。</p>
<h3 id="参考代码"><a href="#参考代码" class="headerlink" title="参考代码"></a>参考代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.iot.mybatis.jdbc;</span><br><span class="line"></span><br><span class="line"><span class="comment">//import java.sql.*;</span></span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.DriverManager;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2016/2/21.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JdbcTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//数据库连接</span></span><br><span class="line">        <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//预编译的Statement，使用预编译的Statement提高数据库性能</span></span><br><span class="line">        <span class="type">PreparedStatement</span> <span class="variable">preparedStatement</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="comment">//结果集</span></span><br><span class="line">        <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//加载数据库驱动</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//通过驱动管理类获取数据库链接</span></span><br><span class="line">            connection =  DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://120.25.162.238:3306/mybatis001?characterEncoding=utf-8&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">            <span class="comment">//定义sql语句 ?表示占位符</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> <span class="string">&quot;select * from user where username = ?&quot;</span>;</span><br><span class="line">            <span class="comment">//获取预处理statement</span></span><br><span class="line">            preparedStatement = connection.prepareStatement(sql);</span><br><span class="line">            <span class="comment">//设置参数，第一个参数为sql语句中参数的序号（从1开始），第二个参数为设置的参数值</span></span><br><span class="line">            preparedStatement.setString(<span class="number">1</span>, <span class="string">&quot;王五&quot;</span>);</span><br><span class="line">            <span class="comment">//向数据库发出sql执行查询，查询出结果集</span></span><br><span class="line">            resultSet =  preparedStatement.executeQuery();</span><br><span class="line">            <span class="comment">//遍历查询结果集</span></span><br><span class="line">            <span class="keyword">while</span>(resultSet.next())&#123;</span><br><span class="line">                System.out.println(resultSet.getString(<span class="string">&quot;id&quot;</span>)+<span class="string">&quot;  &quot;</span>+resultSet.getString(<span class="string">&quot;username&quot;</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span>&#123;</span><br><span class="line">            <span class="comment">//释放资源</span></span><br><span class="line">            <span class="keyword">if</span>(resultSet!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    resultSet.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(preparedStatement!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    preparedStatement.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(connection!=<span class="literal">null</span>)&#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    connection.close();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                    <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="JDBC-向-Mybatis-的转化"><a href="#JDBC-向-Mybatis-的转化" class="headerlink" title="JDBC 向 Mybatis 的转化"></a>JDBC 向 Mybatis 的转化</h3><p>JDBC 存在的问题以及相应的解决方案</p>
<h4 id="数据库的连接获取和释放"><a href="#数据库的连接获取和释放" class="headerlink" title="数据库的连接获取和释放"></a>数据库的连接获取和释放</h4><ul>
<li>数据库连接频繁的开启和关闭本身就造成了资源的浪费，影响系统的性能。</li>
</ul>
<blockquote>
<p>数据库连接的获取和关闭我们可以<strong>使用数据库连接池来解决资源浪费的问题</strong>。通过连接池就可以反复利用已经建立的连接去访问数据库了。减少连接的开启和关闭的时间。</p>
</blockquote>
<ul>
<li>但是现在连接池多种多样，可能存在变化，有可能采用DBCP的连接池，也有可能采用容器本身的JNDI数据库连接池</li>
</ul>
<blockquote>
<p>我们可以通过<strong>DataSource进行隔离解耦</strong>，我们统一从<code>DataSource</code>里面获取数据库连接，DataSource具体由DBCP实现还是由容器的JNDI实现都可以，所以我们将DataSource的具体实现通过让用户配置来应对变化</p>
</blockquote>
<h4 id="SQL-的统一存取"><a href="#SQL-的统一存取" class="headerlink" title="SQL 的统一存取"></a>SQL 的统一存取</h4><p>我们使用JDBC进行操作数据库时，<strong>SQL语句基本都散落在各个JAVA类中</strong>，这样有三个不足之处：</p>
<ol>
<li>可读性很差，不利于维护以及做性能调优。</li>
<li>改动Java代码需要重新编译、打包部署。</li>
<li>不利于取出SQL在数据库客户端执行（取出后还得删掉中间的Java代码，编写好的SQL语句写好后还得通过＋号在Java进行拼凑）。</li>
</ol>
<ul>
<li><p>我们可以考虑<strong>不把SQL语句写到Java代码中</strong>，那么把SQL语句放到哪里呢？首先需要有一个统一存放的地方，我们可以<strong>将这些SQL语句统一集中放到配置文件或者数据库里面（以key-value的格式存放）。然后通过SQL语句的key值去获取对应的SQL语句。</strong>  </p>
</li>
<li><p>既然我们将SQL语句都统一放在配置文件或者数据库中，那么这里就涉及一个<strong>SQL语句的加载问题</strong>。</p>
</li>
</ul>
<h4 id="传入参数映射和动态SQL"><a href="#传入参数映射和动态SQL" class="headerlink" title="传入参数映射和动态SQL"></a>传入参数映射和动态SQL</h4><ul>
<li><p>很多情况下，我们都可以通过在SQL语句中设置占位符来达到使用传入参数的目的，这种方式本身就有一定局限性，它是按照一定顺序传入参数的，要与占位符一一匹配。但是，如果我们<strong>传入的参数是不确定的</strong>（比如列表查询，根据用户填写的查询条件不同，传入查询的参数也是不同的，有时是一个参数、有时可能是三个参数），那么我们就得<strong>在后台代码中自己根据请求的传入参数去拼凑相应的SQL语句，这样的话还是避免不了在Java代码里面写SQL语句</strong>的命运。既然我们已经把SQL语句统一存放在配置文件或者数据库中了，<em><strong>怎么做到能够根据前台传入参数的不同，动态生成对应的SQL语句呢</strong></em>？</p>
<ul>
<li><p>我们先解决这个动态问题，按照我们正常的程序员思维是，<strong>通过if和else这类的判断来进行是最直观的</strong>，这个时候我们想到了JSTL中的这样的标签，那么，能不能将这类的标签引入到SQL语句中呢？假设可以，那么我们这里就需要一个专门的SQL解析器来解析这样的SQL语句，但是，if判断的变量来自于哪里呢？传入的值本身是可变的，那么我们得为这个值定义一个不变的变量名称，而且这个变量名称必须和对应的值要有对应关系，可以通过这个变量名称找到对应的值，这个时候我们想到了<code>key-value的Map</code>。<strong>解析的时候根据变量名的具体值来判断</strong>。</p>
</li>
<li><p>假如前面可以判断没有问题，那么假如判断的结果是true，那么就需要<strong>输出的标签里面的SQL片段</strong>，但是怎么解决在标签里面使用变量名称的问题呢？这里我们需要使用一种<strong>有别于SQL的语法来嵌入变量（比如使用＃变量名＃）</strong>。这样，SQL语句经过解析后就可以动态的生成符合上下文的SQL语句。</p>
</li>
<li><p><strong>怎么区分开占位符变量和非占位变量</strong>？有时候我们单单使用占位符是满足不了的，占位符只能为查询条件占位，SQL语句其他地方使用不了。这里我们可以<strong>使用#变量名#表示占位符变量，使用变量名表示非占位符变量</strong>。</p>
</li>
</ul>
</li>
</ul>
<h4 id="结果映射和结果缓存"><a href="#结果映射和结果缓存" class="headerlink" title="结果映射和结果缓存"></a>结果映射和结果缓存</h4><ul>
<li><p><code>执行SQL语句、获取执行结果、对执行结果进行转换处理、释放相关资源</code>是一整套下来的。假如是执行查询语句，那么执行SQL语句后，返回的是一个ResultSet结果集，这个时候我们就<strong>需要将ResultSet对象的数据取出来，不然等到释放资源时就取不到这些结果信息</strong>了。我们从前面的优化来看，以及将获取连接、设置传入参数、执行SQL语句、释放资源这些都封装起来了，只剩下结果处理这块还没有进行封装，如果能封装起来，每个数据库操作都不用自己写那么一大堆Java代码，直接调用一个封装的方法就可以搞定了。</p>
</li>
<li><p>我们分析一下，一般对执行结果的有哪些处理，有可能将结果不做任何处理就直接返回，也有可能将结果转换成一个JavaBean对象返回、一个Map返回、一个List返回等，结果处理可能是多种多样的。从这里看，我们<code>必须告诉SQL处理器两点</code>：</p>
<ul>
<li>第一，需要返回什么类型的对象；</li>
<li>第二，需要返回的对象的数据结构怎么跟执行的结果映射，这样才能将具体的值copy到对应的数据结构上。</li>
</ul>
</li>
<li><p>接下来，我们可以进而<strong>考虑对SQL执行结果的缓存来提升性能</strong>。缓存数据都是<code>key-value</code>的格式，那么这个key怎么来呢？怎么保证唯一呢？即使同一条SQL语句几次访问的过程中由于传入参数的不同，得到的执行SQL语句也是不同的。那么缓存起来的时候是多对。<strong>但是SQL语句和传入参数两部分合起来可以作为数据缓存的key值。</strong></p>
</li>
</ul>
<h4 id="解决重复SQL语句问题"><a href="#解决重复SQL语句问题" class="headerlink" title="解决重复SQL语句问题"></a>解决重复SQL语句问题</h4><ul>
<li><p>由于我们将所有SQL语句都放到配置文件中，这个时候会遇到一个SQL重复的问题，几个功能的SQL语句其实都差不多，有些可能是SELECT后面那段不同、有些可能是WHERE语句不同。有时候表结构改了，那么我们就需要改多个地方，不利于维护。</p>
</li>
<li><p>当我们的代码程序出现重复代码时怎么办？将重复的代码抽离出来成为独立的一个类，然后在各个需要使用的地方进行引用。对于SQL重复的问题，我们也可以采用这种方式，通过<strong>将SQL片段模块化，将重复的SQL片段独立成一个SQL块，然后在各个SQL语句引用重复的SQL块</strong>，这样需要修改时只需要修改一处即可</p>
</li>
</ul>
<h2 id="MyBatis概述"><a href="#MyBatis概述" class="headerlink" title="MyBatis概述"></a>MyBatis概述</h2><h3 id="MyBatis介绍"><a href="#MyBatis介绍" class="headerlink" title="MyBatis介绍"></a>MyBatis介绍</h3><ul>
<li><p><code>mybatis</code>是一个持久层的框架，是<code>apache</code>下的顶级项目。</p>
</li>
<li><p><code>mybatis</code>让程序将主要精力放在sql上，通过mybatis提供的映射方式，自由灵活生成（半自动化，大部分需要程序员编写sql）满足需要sql语句。</p>
</li>
<li><p><code>mybatis</code>可以将向 <code>preparedStatement</code> 中的输入参数自动进行输入映射，将查询结果集灵活<strong>映射成java对象</strong>。（<strong>输出映射</strong>）</p>
</li>
</ul>
<h3 id="框架原理"><a href="#框架原理" class="headerlink" title="框架原理"></a>框架原理</h3><p>框架结构图</p>
<p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2lEC0s"><img src="https://z3.ax1x.com/2021/06/02/2lEC0s.png" alt="2lEC0s.png"></a></p>
<h3 id="mybatis框架执行过程"><a href="#mybatis框架执行过程" class="headerlink" title="mybatis框架执行过程"></a>mybatis框架执行过程</h3><p><a target="_blank" rel="noopener" href="https://imgtu.com/i/2lEZ1U"><img src="https://z3.ax1x.com/2021/06/02/2lEZ1U.png" alt="2lEZ1U.png"></a></p>
<ol>
<li><p><strong>配置mybatis的配置文件</strong>，SqlMapConfig.xml（名称不固定）</p>
</li>
<li><p>通过配置文件，<strong>加载mybatis运行环境</strong>，创建<code>SqlSessionFactory会话工厂</code>(SqlSessionFactory在实际使用时按单例方式)</p>
</li>
<li><p>通过<code>SqlSessionFactory</code>创建SqlSession。<code>SqlSession</code>是一个面向用户接口（提供操作数据库方法），实现对象是线程不安全的，建议sqlSession应用场合在方法体内。</p>
</li>
<li><p>调用<code>sqlSession</code>的方法去操作数据。如果需要提交事务，需要执行SqlSession的<code>commit()</code>方法。</p>
</li>
<li><p>释放资源，关闭<code>SqlSession</code>。</p>
</li>
</ol>
<h3 id="mybatis开发dao的方法"><a href="#mybatis开发dao的方法" class="headerlink" title="mybatis开发dao的方法"></a>mybatis开发dao的方法</h3><ol>
<li><code>原始dao 的方法</code></li>
</ol>
<ul>
<li><p>需要程序员编写dao接口和实现类</p>
</li>
<li><p>需要在dao实现类中注入一个SqlSessionFactory工厂</p>
</li>
</ul>
<ol start="2">
<li><code>mapper代理开发方法</code>（建议使用）</li>
</ol>
<ul>
<li><p>只需要程序员编写<code>mapper接口</code>（就是dao接口）。</p>
</li>
<li><p>程序员在编写<code>mapper.xml(映射文件)</code>和<code>mapper.java</code>需要遵循一个开发规范：</p>
<ul>
<li>mapper.xml中<code>namespace</code>就是mapper.java的类全路径。</li>
<li>mapper.xml中<code>statement的id</code>和mapper.java中方法名一致。</li>
<li>mapper.xml中<code>statement的parameterType</code>指定输入参数的类型和mapper.java的方法输入参数类型一致</li>
<li>mapper.xml中<code>statement的resultType</code>指定输出结果的类型和mapper.java的方法返回值类型一致。</li>
</ul>
</li>
</ul>
<p><strong>SqlMapConfig.xml配置文件</strong>：可以配置properties属性、别名、mapper加载。</p>
<h3 id="输入映射和输出映射"><a href="#输入映射和输出映射" class="headerlink" title="输入映射和输出映射"></a>输入映射和输出映射</h3><ul>
<li><strong>输入映射</strong>：<ul>
<li><code>parameterType</code>：指定输入参数类型可以简单类型、pojo、hashmap。</li>
<li>对于<code>综合查询</code>，建议parameterType使用<code>包装的pojo</code>，有利于系统扩展。</li>
</ul>
</li>
<li><strong>输出映射</strong>：<ul>
<li><code>resultType</code>：查询到的列名和resultType指定的pojo的属性名一致，才能映射成功。</li>
<li><code>reusltMap</code>：可以通过resultMap 完成一些高级映射。如果查询到的列名和映射的pojo的属性名不一致时，通过resultMap设置列名和属性名之间的对应关系（映射关系）。可以完成映射。</li>
</ul>
</li>
<li><strong>高级映射</strong>：<ul>
<li>将关联查询的列映射到一个<code>pojo属性</code>中。（<strong>一对一</strong>）</li>
<li>将关联查询的列映射到一个<code>List</code>中。（<strong>一对多</strong>）</li>
</ul>
</li>
</ul>
<h3 id="动态sql"><a href="#动态sql" class="headerlink" title="动态sql"></a>动态sql</h3><h3 id="mybatis和hibernate本质区别和应用场景"><a href="#mybatis和hibernate本质区别和应用场景" class="headerlink" title="mybatis和hibernate本质区别和应用场景"></a>mybatis和hibernate本质区别和应用场景</h3><ul>
<li><p><strong>hibernate</strong>  </p>
<ul>
<li><p>是一个<strong>标准ORM框架（对象关系映射）</strong>。入门门槛较高的，不需要程序写sql，sql语句自动生成了。对sql语句进行优化、修改比较困难的。</p>
</li>
<li><p><strong>应用场景</strong>：适用与需求变化不多的<code>中小型项目</code>，比如：后台管理系统，erp、orm、oa。。</p>
</li>
</ul>
</li>
<li><p><strong>mybatis</strong></p>
</li>
<li><p>专注是sql本身，需要程序员自己编写sql语句，sql修改、优化比较方便。<strong>mybatis是一不完全的ORM框架</strong>，虽然程序员自己写sql，mybatis也可以实现映射（输入映射、输出映射）。</p>
</li>
<li><p><strong>应用场景</strong>：适用与<code>需求变化较多的项目</code>，比如：互联网项目。</p>
</li>
</ul>
<h2 id="入门程序"><a href="#入门程序" class="headerlink" title="入门程序"></a>入门程序</h2><h3 id="入门程序（一）"><a href="#入门程序（一）" class="headerlink" title="入门程序（一）"></a>入门程序（一）</h3><p>仅仅<strong>使用 Mybatis 进行简单的查询</strong></p>
<h4 id="工程结构"><a href="#工程结构" class="headerlink" title="工程结构"></a>工程结构</h4><blockquote>
<p><strong>SqlMapConfig.xml</strong></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!DOCTYPE configuration</span><br><span class="line">        PUBLIC <span class="string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span><br><span class="line">&lt;configuration&gt;</span><br><span class="line">    &lt;!-- 和spring整合后 environments配置将废除--&gt;</span><br><span class="line">    &lt;environments <span class="keyword">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line">        &lt;environment id=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line">            &lt;!-- 使用jdbc事务管理，事务控制由mybatis--&gt;</span><br><span class="line">            &lt;transactionManager type=<span class="string">&quot;JDBC&quot;</span> /&gt;</span><br><span class="line">            &lt;!-- 数据库连接池,由mybatis管理--&gt;</span><br><span class="line">            &lt;dataSource type=<span class="string">&quot;POOLED&quot;</span>&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;driver&quot;</span> value=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> /&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;jdbc:mysql://120.25.162.238:3306/mybatis001?characterEncoding=utf-8&quot;</span> /&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;root&quot;</span> /&gt;</span><br><span class="line">                &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;123&quot;</span> /&gt;</span><br><span class="line">            &lt;/dataSource&gt;</span><br><span class="line">        &lt;/environment&gt;</span><br><span class="line">    &lt;/environments&gt;</span><br><span class="line"></span><br><span class="line">&lt;/configuration&gt;</span><br></pre></td></tr></table></figure>

<h4 id="映射文件"><a href="#映射文件" class="headerlink" title="映射文件"></a>映射文件</h4><blockquote>
<p><strong>sqlmap&#x2F;User.xml</strong></p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> mapper</span><br><span class="line">        <span class="variable constant_">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;!-- namespace 命名空间，作用就是对sql进行分类化管理,理解为sql隔离</span><br><span class="line"> 注意：使用mapper代理方法开发，namespace有特殊重要的作用</span><br><span class="line"> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 在映射文件中配置很多sql语句 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--需求:通过id查询用户表的记录 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 通过select执行数据库查询</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     id:标识映射文件中的sql，称为statement的id</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     将sql语句封装到mappedStatement对象中，所以将id称为statement的id</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     parameterType:指定输入参数的类型</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     #&#123;&#125;标示一个占位符,</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     #&#123;value&#125;其中value表示接收输入参数的名称，如果输入参数是简单类型，那么#&#123;&#125;中的值可以任意。</span></span></span><br><span class="line"><span class="comment"><span class="language-xml"></span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     resultType：指定sql输出结果的映射的java对象类型，select指定resultType表示将单条记录映射成java对象</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT * FROM  user  WHERE id=#&#123;value&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 根据用户名称模糊查询用户信息，可能返回多条</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	resultType：指定就是单条记录所映射的java对象类型</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	$&#123;&#125;:表示拼接sql串，将接收到参数的内容不加任何修饰拼接在sql中。</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	使用$&#123;&#125;拼接sql，引起 sql注入</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	$&#123;value&#125;：接收输入参数的内容，如果传入类型是简单类型，$&#123;&#125;中只能使用value</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByName&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT * FROM user WHERE username LIKE &#x27;%$&#123;value&#125;%&#x27;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<p>在<code>sqlMapConfig.xml</code>中<strong>加载User.xml</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 加载映射文件--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;sqlmap/User.xml&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h4 id="程序代码"><a href="#程序代码" class="headerlink" title="程序代码"></a>程序代码</h4><ul>
<li><strong>pojo：User.java</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.iot.mybatis.po;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2016/2/21.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="comment">//属性名要和数据库表的字段对应</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String username;<span class="comment">// 用户姓名</span></span><br><span class="line">    <span class="keyword">private</span> String sex;<span class="comment">// 性别</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;<span class="comment">// 生日</span></span><br><span class="line">    <span class="keyword">private</span> String address;<span class="comment">// 地址</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 省略 set/get 方法</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;User [id=&quot;</span> + id + <span class="string">&quot;, username=&quot;</span> + username + <span class="string">&quot;, sex=&quot;</span> + sex</span><br><span class="line">                + <span class="string">&quot;, birthday=&quot;</span> + birthday + <span class="string">&quot;, address=&quot;</span> + address + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>测试代码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.iot.mybatis.first;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.iot.mybatis.po.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Administrator on 2016/2/23.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisFirst</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据id查询用户信息，得到一条记录结果</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findUserByIdTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException&#123;</span><br><span class="line">        <span class="comment">// mybatis配置文件</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;SqlMapConfig.xml&quot;</span>;</span><br><span class="line">        <span class="comment">// 得到配置文件流</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span>  Resources.getResourceAsStream(resource);</span><br><span class="line">        <span class="comment">//创建会话工厂，传入mybatis配置文件的信息</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过工厂得到SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过SqlSession操作数据库</span></span><br><span class="line">        <span class="comment">// 第一个参数：映射文件中statement的id，等于=namespace+&quot;.&quot;+statement的id</span></span><br><span class="line">        <span class="comment">// 第二个参数：指定和映射文件中所匹配的parameterType类型的参数</span></span><br><span class="line">        <span class="comment">// sqlSession.selectOne结果 是与映射文件中所匹配的resultType类型的对象</span></span><br><span class="line">        <span class="comment">// selectOne查询出一条记录</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;test.findUserById&quot;</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 根据用户名称模糊查询用户列表</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">findUserByNameTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="comment">// mybatis配置文件</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;SqlMapConfig.xml&quot;</span>;</span><br><span class="line">        <span class="comment">// 得到配置文件流</span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建会话工厂，传入mybatis的配置文件信息</span></span><br><span class="line">        <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>()</span><br><span class="line">                .build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 通过工厂得到SqlSession</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">// list中的user和映射文件中resultType所指定的类型一致</span></span><br><span class="line">        List&lt;User&gt; list = sqlSession.selectList(<span class="string">&quot;test.findUserByName&quot;</span>, <span class="string">&quot;小明&quot;</span>);</span><br><span class="line">        System.out.println(list);</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>输出</strong></p>
<ul>
<li><code>findUserByIdTest()</code></li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">DEBUG [main] - ==&gt;  Preparing: SELECT * FROM user WHERE id=? </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: <span class="number">1</span>(Integer)</span><br><span class="line">DEBUG [main] - &lt;==      Total: <span class="number">1</span></span><br><span class="line">User [id=<span class="number">1</span>, username=王五, sex=<span class="number">2</span>, birthday=<span class="literal">null</span>, address=<span class="literal">null</span>]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>- </p>
<ul>
<li><code>findUserByNameTest()</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">DEBUG [main] - ==&gt;  Preparing: SELECT * FROM user WHERE username LIKE <span class="string">&#x27;%小明%&#x27;</span> </span><br><span class="line">DEBUG [main] - ==&gt; Parameters: </span><br><span class="line">DEBUG [main] - &lt;==      Total: <span class="number">3</span></span><br><span class="line">[User [id=<span class="number">16</span>, username=张小明, sex=<span class="number">1</span>, birthday=<span class="literal">null</span>, address=河南郑州], User [id=<span class="number">22</span>, username=陈小明, sex=<span class="number">1</span>, birthday=<span class="literal">null</span>, address=河南郑州], User [id=<span class="number">25</span>, username=陈小明, sex=<span class="number">1</span>, birthday=<span class="literal">null</span>, address=河南郑州]]</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li><p><code>parameterType</code><br>在映射文件中通过<code>parameterType</code><strong>指定输入参数的类型</strong></p>
</li>
<li><p><code>resultType</code><br>在映射文件中通过<code>resultType</code><strong>指定输出结果的类型</strong></p>
</li>
<li><p><code>#&#123;&#125;和$&#123;&#125;</code><br><code>#&#123;&#125;</code>表示一个<strong>占位符号</strong>;<br><code>$&#123;&#125;</code>表示一个<strong>拼接符号</strong>，会引起sql注入，所以<em><strong>不建议使用</strong></em></p>
</li>
<li><p><code>selectOne 和 selectList</code><br><code>selectOne</code>表示<strong>查询一条记录进行映射</strong>，使用selectList也可以使用，只不过只有一个对象</p>
</li>
<li><p><code>selectList </code></p>
</li>
</ul>
<p>表示<strong>查询出一个列表(参数记录)进行映射</strong>，不能够使用selectOne查，不然会报下面的错:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.exceptions.TooManyResultsException: Expected one result (or null) to be returned by selectOne(), but found: 3</span><br></pre></td></tr></table></figure>

<h3 id="入门程序二"><a href="#入门程序二" class="headerlink" title="入门程序二"></a>入门程序二</h3><p><strong>添加、删除、更新用户</strong></p>
<h4 id="映射文件-1"><a href="#映射文件-1" class="headerlink" title="映射文件"></a>映射文件</h4><ul>
<li><strong>User.xml</strong>,在入门程序一基础上增加<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 添加用户</span><br><span class="line">    parameterType：指定输入 参数类型是pojo（包括 用户信息）</span><br><span class="line">    #&#123;&#125;中指定pojo的属性名，接收到pojo对象的属性值，mybatis通过<span class="variable constant_">OGNL</span>获取对象的属性值</span><br><span class="line">    --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     将插入数据的主键返回，返回到user对象中</span></span></span><br><span class="line"><span class="comment"><span class="language-xml"></span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     SELECT LAST_INSERT_ID()：得到刚insert进去记录的主键值，只适用与自增主键</span></span></span><br><span class="line"><span class="comment"><span class="language-xml"></span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     keyProperty：将查询到主键值设置到parameterType指定的对象的哪个属性</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     order：SELECT LAST_INSERT_ID()执行顺序，相对于insert语句来说它的执行顺序</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     resultType：指定SELECT LAST_INSERT_ID()的结果类型</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">      --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      SELECT LAST_INSERT_ID()</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    INSERT INTO user (username,birthday,sex,address)values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        使用mysql的uuid（）生成主键</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        执行过程：</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        首先通过uuid()得到主键，将主键设置到user对象的id属性中</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        其次在insert执行时，从user对象中取出id属性值</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">         --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--  &lt;selectKey keyProperty=&quot;id&quot; order=&quot;BEFORE&quot; resultType=&quot;java.lang.String&quot;&gt;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        SELECT uuid()</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    &lt;/selectKey&gt;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    insert into user(id,username,birthday,sex,address) value(#&#123;id&#125;,#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;) --&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!-- 删除 用户</span><br><span class="line">    根据id删除用户，需要输入 id值</span><br><span class="line">     --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    delete from user where id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">&lt;!-- 根据id更新用户</span><br><span class="line">分析：</span><br><span class="line">需要传入用户的id</span><br><span class="line">需要传入用户的更新信息</span><br><span class="line">parameterType指定user对象，包括 id和更新信息，注意：id必须存在</span><br><span class="line">#&#123;id&#125;：从输入 user对象中获取id属性值</span><br><span class="line"> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125;</span></span><br><span class="line"><span class="language-xml">    where id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
(<em><strong>注</strong></em>：这里的birthday字段在mysql表中是<code>DATE类型</code>，在User类中birthday属性是java的<code>java.util.Date</code>类型，并没有进行转换就插入成功了。</li>
</ul>
<p>看到有的文章说，在字段中有<code>Date</code>和<code>DateTime</code>类型，在插入数据时只要将实体的属性设置成<code>Timestamp</code>就会对应mysql的DateTime类型，Date会对应mysql的Date类型:<br><code>#&#123;modified_date,jdbcType=TIMESTAMP&#125;、#&#123;date,jdbcType=DATE&#125;</code></p>
<p>上面的<code>birthday</code>，配置成<code>#&#123;birthday,jdbcType=TIMESTAMP&#125;</code>，结果也插入成功了，具体实现待查)</p>
<h4 id="程序代码-1"><a href="#程序代码-1" class="headerlink" title="程序代码"></a>程序代码</h4><ul>
<li><strong>User.java</strong>,在入门程序一基础上增加三个测试方法<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 添加用户信息</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUserTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="comment">// mybatis配置文件</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;SqlMapConfig.xml&quot;</span>;</span><br><span class="line">      <span class="comment">// 得到配置文件流</span></span><br><span class="line">      <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建会话工厂，传入mybatis的配置文件信息</span></span><br><span class="line">      <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>()</span><br><span class="line">              .build(inputStream);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 通过工厂得到SqlSession</span></span><br><span class="line">      <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">      <span class="comment">// 插入用户对象</span></span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">      user.setUsername(<span class="string">&quot;王小军&quot;</span>);</span><br><span class="line">      user.setBirthday(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">      user.setSex(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">      user.setAddress(<span class="string">&quot;河南郑州&quot;</span>);</span><br><span class="line"></span><br><span class="line">      sqlSession.insert(<span class="string">&quot;test.insertUser&quot;</span>, user);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 提交事务</span></span><br><span class="line">      sqlSession.commit();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 获取用户信息主键</span></span><br><span class="line">      System.out.println(user.getId());</span><br><span class="line">      <span class="comment">// 关闭会话</span></span><br><span class="line">      sqlSession.close();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 根据id删除 用户信息</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUserTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="comment">// mybatis配置文件</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;SqlMapConfig.xml&quot;</span>;</span><br><span class="line">      <span class="comment">// 得到配置文件流</span></span><br><span class="line">      <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建会话工厂，传入mybatis的配置文件信息</span></span><br><span class="line">      <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>()</span><br><span class="line">              .build(inputStream);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 通过工厂得到SqlSession</span></span><br><span class="line">      <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 传入id删除 用户</span></span><br><span class="line">      sqlSession.delete(<span class="string">&quot;test.deleteUser&quot;</span>, <span class="number">29</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 提交事务</span></span><br><span class="line">      sqlSession.commit();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 关闭会话</span></span><br><span class="line">      sqlSession.close();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 更新用户信息</span></span><br><span class="line">  <span class="meta">@Test</span></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUserTest</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">      <span class="comment">// mybatis配置文件</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;SqlMapConfig.xml&quot;</span>;</span><br><span class="line">      <span class="comment">// 得到配置文件流</span></span><br><span class="line">      <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 创建会话工厂，传入mybatis的配置文件信息</span></span><br><span class="line">      <span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>()</span><br><span class="line">              .build(inputStream);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 通过工厂得到SqlSession</span></span><br><span class="line">      <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">      <span class="comment">// 更新用户信息</span></span><br><span class="line"></span><br><span class="line">      <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">      <span class="comment">//必须设置id</span></span><br><span class="line">      user.setId(<span class="number">27</span>);</span><br><span class="line">      user.setUsername(<span class="string">&quot;王大军&quot;</span>);</span><br><span class="line">      user.setBirthday(<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">      user.setSex(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">      user.setAddress(<span class="string">&quot;河南郑州&quot;</span>);</span><br><span class="line"></span><br><span class="line">      sqlSession.update(<span class="string">&quot;test.updateUser&quot;</span>, user);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 提交事务</span></span><br><span class="line">      sqlSession.commit();</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 关闭会话</span></span><br><span class="line">      sqlSession.close();</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>自增主键返回</strong><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;selectKey keyProperty=<span class="string">&quot;id&quot;</span> order=<span class="string">&quot;AFTER&quot;</span> resultType=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span><br><span class="line">          <span class="variable constant_">SELECT</span> <span class="title function_">LAST_INSERT_ID</span>()</span><br><span class="line">&lt;/selectKey&gt;</span><br></pre></td></tr></table></figure>
如果没有在上面的配置中配置<code>resultType</code>，则会报下面的异常<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">org.apache.ibatis.exceptions.PersistenceException: </span><br><span class="line">### Error updating database.  Cause: org.apache.ibatis.executor.ExecutorException: A query was run and no Result Maps were found for the Mapped Statement &#x27;test.insertUser!selectKey&#x27;.  It&#x27;s likely that neither a Result Type nor a Result Map was specified.</span><br><span class="line">### The error may exist in sqlmap/User.xml</span><br><span class="line">### The error may involve test.insertUser!selectKey-Inline</span><br><span class="line">### The error occurred while setting parameters</span><br><span class="line">### SQL: SELECT LAST_INSERT_ID()</span><br><span class="line">### Cause: org.apache.ibatis.executor.ExecutorException: A query was run and no Result Maps were found for the Mapped Statement &#x27;test.insertUser!selectKey&#x27;.  It&#x27;s likely that neither a Result Type nor a Result Map was specified.</span><br><span class="line"></span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">Caused by: org.apache.ibatis.executor.ExecutorException: A query was run and no Result Maps were found for the Mapped Statement &#x27;test.insertUser!selectKey&#x27;.  It&#x27;s likely that neither a Result Type nor a Result Map was specified.</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><blockquote>
<p><strong>#{}和${}</strong></p>
</blockquote>
<ul>
<li><p><code>#&#123;&#125;</code>表示一个占位符号，<code>#&#123;&#125;</code>接收输入参数，类型可以是简单类型，pojo、hashmap。</p>
</li>
<li><p>如果接收简单类型，<code>#&#123;&#125;</code>中可以写成value或其它名称。</p>
</li>
<li><p><code>#&#123;&#125;</code>接收pojo对象值，通过OGNL读取对象中的属性值，通过属性.属性.属性…的方式获取对象属性值。</p>
</li>
<li><p><code>$&#123;&#125;</code>表示一个拼接符号，会引用sql注入，所以不建议使用${}。</p>
</li>
<li><p><code>$&#123;&#125;</code>接收输入参数，类型可以是简单类型，pojo、hashmap。</p>
</li>
<li><p>如果接收简单类型，<code>$&#123;&#125;</code>中只能写成value。</p>
</li>
<li><p><code>$&#123;&#125;</code>接收pojo对象值，通过OGNL读取对象中的属性值，通过属性.属性.属性…的方式获取对象属性值。</p>
</li>
</ul>
<h2 id="开发DAO方法"><a href="#开发DAO方法" class="headerlink" title="开发DAO方法"></a>开发DAO方法</h2><p>讲解<code>SqlSession</code>，并对两种方法( <code>原始dao开发</code>和<code>mapper代理开发</code> )分别做简单展示</p>
<h3 id="SqlSession使用范围"><a href="#SqlSession使用范围" class="headerlink" title="SqlSession使用范围"></a>SqlSession使用范围</h3><ul>
<li><p><strong>SqlSessionFactoryBuilder</strong></p>
<ul>
<li>通过SqlSessionFactoryBuilder<code>创建会话工厂SqlSessionFactory</code>将SqlSessionFactoryBuilder当成一个工具类使用即可，不需要使用单例管理SqlSessionFactoryBuilder。在需要创建SqlSessionFactory时候，只需要new一次SqlSessionFactoryBuilder即可。</li>
</ul>
</li>
<li><p><strong>SqlSessionFactory</strong></p>
<ul>
<li>通过SqlSessionFactory<code>创建SqlSession</code>，使用单例模式管理sqlSessionFactory（工厂一旦创建，使用一个实例）。将来mybatis和spring整合后，使用单例模式管理sqlSessionFactory。</li>
</ul>
</li>
<li><p><strong>SqlSession</strong></p>
<ul>
<li><p><code>SqlSession</code>是一个<strong>面向用户（程序员）的接口</strong>。SqlSession中提供了很多操作数据库的方法：如：selectOne(返回单个对象)、selectList（返回单个或多个对象）。</p>
</li>
<li><p><code>SqlSession</code>是<strong>线程不安全的</strong>，在SqlSesion实现类中除了有接口中的方法（操作数据库的方法）还有数据域属性。</p>
</li>
<li><p><code>SqlSession</code><strong>最佳应用场合在方法体内</strong>，定义成局部变量使用。</p>
</li>
</ul>
</li>
</ul>
<h3 id="原始dao开发方法"><a href="#原始dao开发方法" class="headerlink" title="原始dao开发方法"></a>原始dao开发方法</h3><p>程序员需要写dao接口和dao实现类</p>
<ul>
<li><strong>dao接口</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="comment">//根据id查询用户信息</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据用户名列查询用户列表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByName</span><span class="params">(String name)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加用户信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除用户信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>dao接口实现类</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.iot.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.iot.mybatis.po.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSession;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Created by Brian on 2016/2/24.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line">    <span class="comment">// 需要向dao实现类中注入SqlSessionFactory</span></span><br><span class="line">    <span class="comment">// 这里通过构造方法注入</span></span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserDaoImpl</span><span class="params">(SqlSessionFactory sqlSessionFactory)</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.sqlSessionFactory = sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;test.findUserById&quot;</span>,id);</span><br><span class="line">        <span class="comment">//释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByName</span><span class="params">(String name)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; list = sqlSession.selectList(<span class="string">&quot;test.findUserByName&quot;</span>, name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line">        <span class="comment">//执行插入操作</span></span><br><span class="line">        sqlSession.insert(<span class="string">&quot;test.insertUser&quot;</span>, user);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 提交事务</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//执行插入操作</span></span><br><span class="line">        sqlSession.delete(<span class="string">&quot;test.deleteUser&quot;</span>, id);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 提交事务</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 释放资源</span></span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>测试代码</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.iot.mybatis.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.iot.mybatis.po.User;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactory;</span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.session.SqlSessionFactoryBuilder;</span><br><span class="line"><span class="keyword">import</span> org.junit.Before;</span><br><span class="line"><span class="keyword">import</span> org.junit.Test;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImplTest</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// 此方法是在执行testFindUserById之前执行</span></span><br><span class="line">	<span class="meta">@Before</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">// 创建sqlSessionFactory</span></span><br><span class="line"></span><br><span class="line">		<span class="comment">// mybatis配置文件</span></span><br><span class="line">		<span class="type">String</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="string">&quot;SqlMapConfig.xml&quot;</span>;</span><br><span class="line">		<span class="comment">// 得到配置文件流</span></span><br><span class="line">		<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 创建会话工厂，传入mybatis的配置文件信息</span></span><br><span class="line">		sqlSessionFactory = <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>()</span><br><span class="line">				.build(inputStream);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Test</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindUserById</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">		<span class="comment">// 创建UserDao的对象</span></span><br><span class="line">		<span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>(sqlSessionFactory);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// 调用UserDao的方法</span></span><br><span class="line">		<span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userDao.findUserById(<span class="number">1</span>);</span><br><span class="line">		</span><br><span class="line">		System.out.println(user);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>总结原始dao开发问题</strong>  <ul>
<li><p>dao接口实现类方法中存在大量模板方法，设想能否将这些代码提取出来，大大减轻程序员的工作量。</p>
</li>
<li><p>调用sqlsession方法时将statement的id硬编码了</p>
</li>
<li><p>调用sqlsession方法时传入的变量，由于sqlsession方法使用泛型，即使变量类型传入错误，在编译阶段也不报错，不利于程序员开发。</p>
</li>
</ul>
</li>
</ul>
<h3 id="mapper代理方法"><a href="#mapper代理方法" class="headerlink" title="mapper代理方法"></a>mapper代理方法</h3><p>程序员需要编写</p>
<ul>
<li><code>mapper 接口</code>（相当于dao接口）</li>
<li><code>mapper.xml 映射文件</code></li>
</ul>
<p>程序员编写<code>mapper接口</code>需要遵循一些开发规范，<strong>mybatis可以自动生成mapper接口实现类代理对象。</strong></p>
<h4 id="开发规范"><a href="#开发规范" class="headerlink" title="开发规范"></a>开发规范</h4><ul>
<li><p>在 <code>mapper.xml</code> 中 namespace 等于 mapper 接口地址<br>namespace 命名空间，作用就是对sql进行分类化管理,理解为sql隔离<br>使用 mapper 代理方法开发，namespace 有特殊重要的作用, namespace 等于 mapper 接口地址</p>
</li>
<li><p><code>mapper.java</code>接口中的方法名和mapper.xml中statement的id一致</p>
</li>
<li><p><code>mapper.java</code>接口中的方法输入参数类型和mapper.xml中statement的parameterType指定的类型一致。</p>
</li>
<li><p><code>mapper.java</code>接口中的方法返回值类型和mapper.xml中statement的resultType指定的类型一致。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;findUserById&quot;</span> parameterType=<span class="string">&quot;int&quot;</span> resultType=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span><br><span class="line">    SELECT * FROM  user  WHERE id=#&#123;value&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据id查询用户信息</span></span><br><span class="line"><span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception;</span><br></pre></td></tr></table></figure>
<p><strong>总结</strong>：以上开发规范主要是对下边的代码进行统一生成：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;test.findUserById&quot;</span>, id);</span><br><span class="line">sqlSession.insert(<span class="string">&quot;test.insertUser&quot;</span>, user);</span><br></pre></td></tr></table></figure>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><ul>
<li><p><strong>mapper.xml</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> mapper</span><br><span class="line">        <span class="variable constant_">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;!--</span><br><span class="line"> namespace 命名空间，作用就是对sql进行分类化管理,理解为sql隔离</span><br><span class="line"> 注意：使用mapper代理方法开发，namespace有特殊重要的作用</span><br><span class="line"> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.iot.mybatis.mapper.UserMapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"> <span class="comment">&lt;!-- 在映射文件中配置很多sql语句 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--需求:通过id查询用户表的记录 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 通过select执行数据库查询</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     id:标识映射文件中的sql，称为statement的id</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     将sql语句封装到mappedStatement对象中，所以将id称为statement的id</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     parameterType:指定输入参数的类型</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     #&#123;&#125;标示一个占位符,</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     #&#123;value&#125;其中value表示接收输入参数的名称，如果输入参数是简单类型，那么#&#123;&#125;中的值可以任意。</span></span></span><br><span class="line"><span class="comment"><span class="language-xml"></span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     resultType：指定sql输出结果的映射的java对象类型，select指定resultType表示将单条记录映射成java对象</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT * FROM  user  WHERE id=#&#123;value&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 根据用户名称模糊查询用户信息，可能返回多条</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	resultType：指定就是单条记录所映射的java对象类型</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	$&#123;&#125;:表示拼接sql串，将接收到参数的内容不加任何修饰拼接在sql中。</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	使用$&#123;&#125;拼接sql，引起 sql注入</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	$&#123;value&#125;：接收输入参数的内容，如果传入类型是简单类型，$&#123;&#125;中只能使用value</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByName&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.String&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT * FROM user WHERE username LIKE &#x27;%$&#123;value&#125;%&#x27;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 添加用户</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        parameterType：指定输入 参数类型是pojo（包括 用户信息）</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        #&#123;&#125;中指定pojo的属性名，接收到pojo对象的属性值，mybatis通过OGNL获取对象的属性值</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insertUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">         将插入数据的主键返回，返回到user对象中</span></span></span><br><span class="line"><span class="comment"><span class="language-xml"></span></span></span><br><span class="line"><span class="comment"><span class="language-xml">         SELECT LAST_INSERT_ID()：得到刚insert进去记录的主键值，只适用与自增主键</span></span></span><br><span class="line"><span class="comment"><span class="language-xml"></span></span></span><br><span class="line"><span class="comment"><span class="language-xml">         keyProperty：将查询到主键值设置到parameterType指定的对象的哪个属性</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">         order：SELECT LAST_INSERT_ID()执行顺序，相对于insert语句来说它的执行顺序</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">         resultType：指定SELECT LAST_INSERT_ID()的结果类型</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">          --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">          SELECT LAST_INSERT_ID()</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        INSERT INTO user (username,birthday,sex,address)values (#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;)</span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">            使用mysql的uuid（）生成主键</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">            执行过程：</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">            首先通过uuid()得到主键，将主键设置到user对象的id属性中</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">            其次在insert执行时，从user对象中取出id属性值</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">             --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--  &lt;selectKey keyProperty=&quot;id&quot; order=&quot;BEFORE&quot; resultType=&quot;java.lang.String&quot;&gt;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">            SELECT uuid()</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        &lt;/selectKey&gt;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        insert into user(id,username,birthday,sex,address) value(#&#123;id&#125;,#&#123;username&#125;,#&#123;birthday&#125;,#&#123;sex&#125;,#&#123;address&#125;) --&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 删除 用户</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        根据id删除用户，需要输入 id值</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">         --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        delete from user where id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 根据id更新用户</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    分析：</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    需要传入用户的id</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    需要传入用户的更新信息</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    parameterType指定user对象，包括 id和更新信息，注意：id必须存在</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    #&#123;id&#125;：从输入 user对象中获取id属性值</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateUser&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125;</span></span><br><span class="line"><span class="language-xml">        where id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在<strong>SqlMapConfig.xml</strong>中加载映射文件</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;mappers&gt;  </span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/UserMapper.xml&quot;</span>/&gt;</span></span>  </span><br><span class="line">&lt;/mappers&gt;  </span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>UserMapper.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">//根据id查询用户信息</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据用户名列查询用户列表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserByName</span><span class="params">(String name)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加用户信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insertUser</span><span class="params">(User user)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除用户信息</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//更新用户</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span><span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>UserMapperTest&#x2F;java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserMapperTest</span> &#123;  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;  </span><br><span class="line">      </span><br><span class="line">    <span class="comment">//注解Before是在执行本类所有测试方法之前先调用这个方法  </span></span><br><span class="line">    <span class="meta">@Before</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setup</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">        <span class="comment">//创建SqlSessionFactory  </span></span><br><span class="line">        String resource=<span class="string">&quot;SqlMapConfig.xml&quot;</span>;  </span><br><span class="line">          </span><br><span class="line">        <span class="comment">//将配置文件加载成流  </span></span><br><span class="line">        <span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> Resources.getResourceAsStream(resource);  </span><br><span class="line">        <span class="comment">//创建会话工厂，传入mybatis配置文件的信息  </span></span><br><span class="line">        sqlSessionFactory=<span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>().build(inputStream);  </span><br><span class="line">    &#125;  </span><br><span class="line">      </span><br><span class="line">    <span class="meta">@Test</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">testFindUserById</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;  </span><br><span class="line">          </span><br><span class="line">        SqlSession sqlSession=sqlSessionFactory.openSession();  </span><br><span class="line">          </span><br><span class="line">        <span class="comment">//创建UserMapper代理对象  </span></span><br><span class="line">        UserMapper userMapper=sqlSession.getMapper(UserMapper.class);  </span><br><span class="line">          </span><br><span class="line">        <span class="comment">//调用userMapper的方法  </span></span><br><span class="line">        User user=userMapper.findUserById(<span class="number">1</span>);  </span><br><span class="line">          </span><br><span class="line">        System.out.println(user.getUsername());  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="一些问题总结"><a href="#一些问题总结" class="headerlink" title="一些问题总结"></a>一些问题总结</h4><ul>
<li><p><strong>代理对象内部</strong>调用<code>selectOne</code>或<code>selectList</code></p>
<ul>
<li>如果<code>mapper方法</code>返回单个pojo对象（非集合对象），代理对象内部通过<code>selectOne</code>查询数据库。</li>
<li>如果<code>mapper方法</code>返回集合对象，代理对象内部通过<code>selectList</code>查询数据库。</li>
</ul>
</li>
<li><p><code>mapper接口方法参数</code>只能有一个，系统是否不利于扩展维护?</p>
<p> 系统框架中，dao层的代码是被业务层公用的。即使mapper接口只有一个参数，可以使用包装类型的pojo满足不同的业务方法的需求。</p>
</li>
</ul>
<p><strong>注意</strong>：持久层方法的参数可以包装类型、map…等，<strong>service方法中建议不要使用包装类型</strong>（不利于业务层的可扩展）。</p>
<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><p>本文主要讲解<strong>SqlMapConfig配置文件</strong><br>参考 <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html">mybatis3-configuration</a></p>
<blockquote>
<p><code>SqlMapConfig.xml</code>中配置的内容和顺序如下</p>
</blockquote>
<ul>
<li>properties（属性）</li>
<li>settings（全局配置参数）</li>
<li><strong>typeAliases</strong>（类型别名）</li>
<li>typeHandlers（类型处理器）</li>
<li>objectFactory（对象工厂）</li>
<li>plugins（插件）</li>
<li>environments（环境集合属性对象）<ul>
<li>environment（环境子属性对象）<ul>
<li>transactionManager（事务管理）</li>
<li>dataSource（数据源）</li>
</ul>
</li>
</ul>
</li>
<li><strong>mappers</strong>（映射器）</li>
</ul>
<h3 id="properties-属性"><a href="#properties-属性" class="headerlink" title="properties(属性)"></a>properties(属性)</h3><ul>
<li><p>将数据库连接参数单独配置在<strong>db.properties</strong>中，只需要在<strong>SqlMapConfig.xml中加载db.properties的属性值</strong>。在SqlMapConfig.xml中就不需要对数据库连接参数硬编码。</p>
</li>
<li><p>将数据库连接参数只配置在db.properties中。<strong>原因</strong>：<code>方便对参数进行统一管理，其它xml可以引用该db.properties。</code></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driver=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://120.25.162.238:3306/mybatis001?characterEncoding=utf-8</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=123</span><br></pre></td></tr></table></figure>

<ul>
<li>在<strong>sqlMapConfig.xml</strong>加载属性文件</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties resource=<span class="string">&quot;db.properties&quot;</span>&gt;</span><br><span class="line">        &lt;!--properties中还可以配置一些属性名和属性值  --&gt;</span><br><span class="line">        &lt;!-- &lt;property name=<span class="string">&quot;jdbc.driver&quot;</span> value=<span class="string">&quot;&quot;</span>/&gt; --&gt;</span><br><span class="line">&lt;/properties&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 和spring整合后 environments配置将废除--&gt;</span><br><span class="line">&lt;environments <span class="keyword">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line">    &lt;environment id=<span class="string">&quot;development&quot;</span>&gt;</span><br><span class="line">        &lt;!-- 使用jdbc事务管理，事务控制由mybatis--&gt;</span><br><span class="line">        &lt;transactionManager type=<span class="string">&quot;JDBC&quot;</span> /&gt;</span><br><span class="line">        &lt;!-- 数据库连接池,由mybatis管理--&gt;</span><br><span class="line">        &lt;dataSource type=<span class="string">&quot;POOLED&quot;</span>&gt;</span><br><span class="line">            &lt;property name=<span class="string">&quot;driver&quot;</span> value=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span><br><span class="line">            &lt;property name=<span class="string">&quot;url&quot;</span> value=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span><br><span class="line">            &lt;property name=<span class="string">&quot;username&quot;</span> value=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span><br><span class="line">            &lt;property name=<span class="string">&quot;password&quot;</span> value=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span><br><span class="line">        &lt;/dataSource&gt;</span><br><span class="line">    &lt;/environment&gt;</span><br><span class="line">&lt;/environments&gt;</span><br></pre></td></tr></table></figure>
<p><strong>注意</strong>： <code>MyBatis</code> 将按照下面的顺序(优先级)来加载属性：</p>
<ul>
<li>在<code>properties</code>元素体内定义的属性首先被读取。</li>
<li>然后会读取properties元素中<code>resource</code>或<code>url</code>加载的属性，它会覆盖已读取的同名属性。</li>
<li>最后读取<code>parameterType</code>传递的属性，它会覆盖已读取的同名属性。</li>
</ul>
<p><strong>建议</strong>：</p>
<ul>
<li>不要在<code>properties</code>元素体内添加任何属性值，只将属性值定义在properties文件中。</li>
<li>在<code>properties</code>文件中定义属性名要有一定的特殊性，如：XXXXX.XXXXX.XXXX</li>
</ul>
<h3 id="settings-全局参数配置"><a href="#settings-全局参数配置" class="headerlink" title="settings(全局参数配置)"></a>settings(全局参数配置)</h3><p>mybatis框架在运行时可以调整一些运行参数,比如：开启二级缓存、开启延迟加载…</p>
<p><strong>全局参数</strong>将会影响mybatis的运行行为。具体参考官网：<br><a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#settings">mybatis-setting</a></p>
<h3 id="typeAliases-类型别名"><a href="#typeAliases-类型别名" class="headerlink" title="typeAliases(类型别名)"></a>typeAliases(类型别名)</h3><p>在<strong>mapper.xml</strong>中，定义很多的statement，<code>statement</code>需要<strong>parameterType</strong>指定输入参数的类型、需要<strong>resultType</strong>指定输出结果的映射类型。</p>
<p>如果在指定类型时输入类型全路径，不方便进行开发，可以<strong>针对parameterType或resultType指定的类型定义一些别名</strong>，在<code>mapper.xml</code>中通过别名定义，方便开发。</p>
<ul>
<li>mybatis默认支持别名<br>参考 <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#typeAliases">typeAliases</a></li>
</ul>
<table>
<thead>
<tr>
<th align="center">别名</th>
<th align="center">映射的类型</th>
</tr>
</thead>
<tbody><tr>
<td align="center">_byte</td>
<td align="center">byte</td>
</tr>
<tr>
<td align="center">_long</td>
<td align="center">long</td>
</tr>
<tr>
<td align="center">_short</td>
<td align="center">short</td>
</tr>
<tr>
<td align="center">_int</td>
<td align="center">int</td>
</tr>
<tr>
<td align="center">_integer</td>
<td align="center">int</td>
</tr>
<tr>
<td align="center">_double</td>
<td align="center">double</td>
</tr>
<tr>
<td align="center">_float</td>
<td align="center">float</td>
</tr>
<tr>
<td align="center">_boolean</td>
<td align="center">boolean</td>
</tr>
<tr>
<td align="center">string</td>
<td align="center">String</td>
</tr>
<tr>
<td align="center">byte</td>
<td align="center">Byte</td>
</tr>
<tr>
<td align="center">long</td>
<td align="center">Long</td>
</tr>
<tr>
<td align="center">short</td>
<td align="center">Short</td>
</tr>
<tr>
<td align="center">int</td>
<td align="center">Integer</td>
</tr>
<tr>
<td align="center">integer</td>
<td align="center">Integer</td>
</tr>
<tr>
<td align="center">double</td>
<td align="center">Double</td>
</tr>
<tr>
<td align="center">float</td>
<td align="center">Float</td>
</tr>
<tr>
<td align="center">boolean</td>
<td align="center">Boolean</td>
</tr>
<tr>
<td align="center">date</td>
<td align="center">Date</td>
</tr>
<tr>
<td align="center">decimal</td>
<td align="center">BigDecimal</td>
</tr>
<tr>
<td align="center">bigdecimal</td>
<td align="center">BigDecimal</td>
</tr>
</tbody></table>
<ul>
<li>自定义别名<ul>
<li>单个别名定义</li>
<li>批量定义别名（常用）<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 别名定义 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 针对单个别名定义</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    type：类型的路径</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    alias：别名</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- &lt;typeAlias type=&quot;cn.itcast.mybatis.po.User&quot; alias=&quot;user&quot;/&gt; --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 批量别名定义</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    指定包名，mybatis自动扫描包中的po类，自动定义别名，别名就是类名（首字母大写或小写都可以）</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.iot.mybatis.po&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h3 id="typeHandlers-类型处理器"><a href="#typeHandlers-类型处理器" class="headerlink" title="typeHandlers(类型处理器)"></a>typeHandlers(类型处理器)</h3><p>mybatis中通过<strong>typeHandlers</strong>完成jdbc类型和java类型的转换。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;findUserById&quot;</span> parameterType=<span class="string">&quot;int&quot;</span> resultType=<span class="string">&quot;user&quot;</span>&gt;</span><br><span class="line">		select * <span class="keyword">from</span> user where id = #&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><p><code>mybatis自带的类型处理器</code>基本上满足日常需求，不需要单独定义。</p>
</li>
<li><p><strong>mybatis支持类型处理器</strong></p>
</li>
</ul>
<blockquote>
<p>参考 <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/configuration.html#typeHandlers">typeHandlers</a></p>
</blockquote>
<table>
<thead>
<tr>
<th align="center">类型处理器</th>
<th align="center">Java类型</th>
<th align="center">JDBC类型</th>
</tr>
</thead>
<tbody><tr>
<td align="center">BooleanTypeHandler</td>
<td align="center">Boolean，boolean</td>
<td align="center">任何兼容的布尔值</td>
</tr>
<tr>
<td align="center">ByteTypeHandler</td>
<td align="center">Byte，byte</td>
<td align="center">任何兼容的数字或字节类型</td>
</tr>
<tr>
<td align="center">ShortTypeHandler</td>
<td align="center">Short，short</td>
<td align="center">任何兼容的数字或短整型</td>
</tr>
<tr>
<td align="center">IntegerTypeHandler</td>
<td align="center">Integer，int</td>
<td align="center">任何兼容的数字和整型</td>
</tr>
<tr>
<td align="center">LongTypeHandler</td>
<td align="center">Long，long</td>
<td align="center">任何兼容的数字或长整型(后面还有很多)</td>
</tr>
</tbody></table>
<h3 id="mappers-映射配置"><a href="#mappers-映射配置" class="headerlink" title="mappers(映射配置)"></a>mappers(映射配置)</h3><ul>
<li>通过<code>resource</code>加载单个映射文件<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!--通过resource方法一次加载一个映射文件 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/UserMapper.xml&quot;</span>/&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li>通过<code>mapper接口</code>加载单个mapper<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!-- 通过mapper接口加载单个 映射文件</span><br><span class="line">        遵循一些规范：需要将mapper接口类名和mapper.<span class="property">xml</span>映射文件名称保持一致，且在一个目录中</span><br><span class="line">        上边规范的前提是：使用的是mapper代理方法</span><br><span class="line">         --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;com.iot.mybatis.mapper.UserMapper&quot;</span>/&gt;</span></span> </span><br></pre></td></tr></table></figure></li>
<li>目录示例<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">com.iot.mybatis.mapper------------------package包</span><br><span class="line">           |----UserMapper.java</span><br><span class="line">           |----UserMapper.xml</span><br><span class="line">```           </span><br><span class="line"></span><br><span class="line">- 批量加载mapper(推荐使用)</span><br><span class="line">```js</span><br><span class="line">&lt;!-- 批量加载mapper</span><br><span class="line">		指定mapper接口的包名，mybatis自动扫描包下边所有mapper接口进行加载</span><br><span class="line">		遵循一些规范：需要将mapper接口类名和mapper.xml映射文件名称保持一致，且在一个目录 中</span><br><span class="line">		上边规范的前提是：使用的是mapper代理方法</span><br><span class="line">		 --&gt;</span><br><span class="line">&lt;package name=&quot;com.iot.mybatis.mapper&quot;/&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="sql片段-重点"><a href="#sql片段-重点" class="headerlink" title="sql片段(重点)"></a>sql片段(重点)</h3><p>将上边实现的动态sql判断代码块抽取出来，组成一个sql片段。其它的statement中就可以引用sql片段。</p>
<ul>
<li><p><strong>定义sql片段</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 定义sql片段</span><br><span class="line">id：sql片段的唯一标识</span><br><span class="line"></span><br><span class="line">经验：是基于单表来定义sql片段，这样话这个sql片段可重用性才高</span><br><span class="line">在sql片段中不要包括 where</span><br><span class="line"> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;query_user_where&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userCustom!=null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userCustom.sex!=null and userCustom.sex!=&#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            AND user.sex = #&#123;userCustom.sex&#125;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;userCustom.username!=null and userCustom.username!=&#x27;&#x27;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            AND user.username LIKE &#x27;%$&#123;userCustom.username&#125;%&#x27;</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>引用sql片段</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 用户信息综合查询</span><br><span class="line">    #&#123;userCustom.<span class="property">sex</span>&#125;:取出pojo包装对象中性别值</span><br><span class="line">    $&#123;userCustom.<span class="property">username</span>&#125;：取出pojo包装对象中用户名称</span><br><span class="line"> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserList&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;com.iot.mybatis.po.UserQueryVo&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">        <span class="attr">resultType</span>=<span class="string">&quot;com.iot.mybatis.po.UserCustom&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    SELECT * FROM user</span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--  where 可以自动去掉条件中的第一个and --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 引用sql片段 的id，如果refid指定的id不在本mapper文件中，需要前边加namespace --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;query_user_where&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 在这里还要引用其它的sql片段  --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="输入映射"><a href="#输入映射" class="headerlink" title="输入映射"></a>输入映射</h2><p>本文主要讲解<code>mybatis的输入映射</code>。</p>
<p>通过<strong>parameterType</strong>指定输入参数的类型，类型可以是</p>
<ul>
<li><code>基本数据类型</code>：包含int,String,Date等。基本数据类型作为传参，只能传入一个。通过#{参数名} 即可获取传入的值</li>
<li><code>复杂数据类型</code>：包含pojo 、Map。通过#{属性名}或#{map的KeyName}即可获取传入的值</li>
</ul>
<h3 id="基本数据类型示例"><a href="#基本数据类型示例" class="headerlink" title="基本数据类型示例"></a>基本数据类型示例</h3><ul>
<li><strong>mapper.xml</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectTeacher&quot;</span> parameterType=<span class="string">&quot;int&quot;</span> resultType=<span class="string">&quot;com.myapp.domain.Teacher&quot;</span>&gt;</span><br><span class="line">	select * <span class="keyword">from</span> <span class="title class_">Teacher</span> where c_id=#&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
因为 java 反射只能获取方法参数的类型,但无从得知方法参数的名字的，所以这里的”参数名“可以是任意的。</li>
</ul>
<h3 id="Map-类型传入示例"><a href="#Map-类型传入示例" class="headerlink" title="Map 类型传入示例"></a>Map 类型传入示例</h3><blockquote>
<p>在基本类型中，我们只能传入一个参数。 如果要传入多个参数怎么办？  </p>
</blockquote>
<ul>
<li><p>比如要查询某个价格区间的商品，那么就需要构建minPrice、maxPrice两个参数，这时可以用到Map。 通过<code>#&#123;map的KeyName&#125;</code>即可获取传入的值。</p>
</li>
<li><p><strong>mapper.xml</strong></p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;searchByPrice&quot;</span> parameterType=<span class="string">&quot;Map&quot;</span> resultType=<span class="string">&quot;Product&quot;</span>&gt;</span><br><span class="line">  select * <span class="keyword">from</span> <span class="title class_">Product</span> where price &gt;= #&#123;minPrice&#125; and price &lt;= #&#123;maxPrice&#125; </span><br><span class="line">&lt;/select&gt;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">Map 的定义</span></span><br><span class="line"><span class="comment">Map&lt;String, Double&gt; pricemap=new HashMap&lt;String,Double&gt;();</span></span><br><span class="line"><span class="comment">pricemap.put(&quot;minPrice&quot;, 1000.00);</span></span><br><span class="line"><span class="comment">pricemap.put(&quot;maxPrice&quot;, 6000.00);</span></span><br><span class="line"><span class="comment"> */</span> </span><br></pre></td></tr></table></figure>

<p>参数传递时，一定要保证sql语句中的<code>#&#123;minPrice&#125;</code>和map中的 <code>key</code> 值 一样，大小写敏感。否则会报参数错误。 Map 类型作为传入参数使用的并不多，主要有两个原因:</p>
<ul>
<li><strong>Map 是一个键值对的集合</strong>，使用者只有通过阅读键的值才能明白其作用</li>
<li><strong>Map</strong> 不能限定其传入的数据时什么类型，容易造成数据混乱很难管理<br>正是因为这个原因，所以<strong>最好是用Java实体（POJO）作为传参</strong>。</li>
</ul>
<h3 id="Pojo-传入示例"><a href="#Pojo-传入示例" class="headerlink" title="Pojo 传入示例"></a>Pojo 传入示例</h3><ul>
<li><p><strong>定义包装类型pojo</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">productVo</span> &#123;</span><br><span class="line">    <span class="title class_">Product</span> pro;</span><br><span class="line"></span><br><span class="line">    public <span class="title class_">Product</span> <span class="title function_">getProduct</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> pro;</span><br><span class="line">    &#125;</span><br><span class="line">    public <span class="keyword">void</span> <span class="title function_">setProduct</span>(<span class="params">Product product</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">pro</span> = product;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>mapper.xml</strong></p>
</li>
<li><p>在<code>UserMapper.xml</code>中定义用户信息综合查询（查询条件复杂，通过高级查询进行复杂关联查询）。</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;searchByPrice&quot;</span> parameterType=<span class="string">&quot;productVo&quot;</span> resultType=<span class="string">&quot;Product&quot;</span>&gt;</span><br><span class="line">    select * <span class="keyword">from</span> <span class="title class_">Product</span> where price &gt;= #&#123;pro.<span class="property">minPrice</span>&#125; and price &lt;= #&#123;pro.<span class="property">maxPrice</span>&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h2 id="输出映射"><a href="#输出映射" class="headerlink" title="输出映射"></a>输出映射</h2><p>本文主要讲解<strong>mybatis的输出映射</strong>。</p>
<ul>
<li>输出映射有两种方式<ul>
<li>resultType</li>
<li>resultMap</li>
</ul>
</li>
</ul>
<p>MyBatis中在查询进行<code>select映射</code>的时候，返回类型可以用<code>resultType</code>，也可以用resultMap，<strong>resultType是直接表示返回类型的，而resultMap则是对外部ResultMap的引用，但是resultType跟resultMap不能同时存在</strong>。在MyBatis进行查询映射时，其实查询出来的每一个属性都是放在一个对应的Map里面的，其中键是属性名，值则是其对应的值。</p>
<ol>
<li><p>当提供的<strong>返回类型属性是resultType</strong>时，MyBatis会将Map里面的键值对取出赋给resultType所指定的对象对应的属性。所以其实MyBatis的每一个查询映射的返回类型都是ResultMap，只是当提供的返回类型属性是resultType的时候，MyBatis对自动的给把对应的值赋给resultType所指定对象的属性。</p>
</li>
<li><p>当提供的<strong>返回类型是resultMap</strong>时，因为Map不能很好表示领域模型，就需要自己再进一步的把它转化为对应的对象，这常常在复杂查询中很有作用。</p>
</li>
</ol>
<h3 id="resultType"><a href="#resultType" class="headerlink" title="resultType"></a>resultType</h3><ul>
<li>使用<code>resultType</code>进行输出映射，<strong>只有查询出来的列名和pojo中的属性名一致，该列才可以映射成功</strong>。对于SQL语句查询出的字段在相应的pojo中必须有和它相同的字段对应，而resultType中的内容就是pojo在本项目中的位置。因此对于单表查询的话用resultType是最合适的。</li>
</ul>
<h3 id="简单示例"><a href="#简单示例" class="headerlink" title="简单示例"></a>简单示例</h3><ul>
<li><strong>mapper.xml</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;typeAlias alias=<span class="string">&quot;Blog&quot;</span> type=<span class="string">&quot;com.tiantian.mybatis.model.Blog&quot;</span>/&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectBlog&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;Blog&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">select * from t_blog where id = #&#123;id&#125;</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="resultMap"><a href="#resultMap" class="headerlink" title="resultMap"></a>resultMap</h3><p><code>mybatis</code>中<strong>使用resultMap完成高级输出结果映射</strong>。(一对多，多对多)</p>
<h3 id="resultMap使用方法"><a href="#resultMap使用方法" class="headerlink" title="resultMap使用方法"></a>resultMap使用方法</h3><p>如果查询出来的列名和pojo的属性名不一致，通过定义一个resultMap对列名和pojo属性名之间作一个映射关系。  </p>
<ol>
<li><p>定义<code>resultMap</code></p>
</li>
<li><p>使用<code>resultMap</code>作为statement的输出映射类型</p>
</li>
</ol>
<ul>
<li><strong>定义reusltMap</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 定义resultMap</span><br><span class="line">	将<span class="variable constant_">SELECT</span> id id_,username username_ <span class="variable constant_">FROM</span> <span class="variable constant_">USER</span> 和<span class="title class_">User</span>类中的属性作一个映射关系</span><br><span class="line">	</span><br><span class="line">	type：resultMap最终映射的java对象类型,可以使用别名</span><br><span class="line">	id：对resultMap的唯一标识</span><br><span class="line">	 --&gt;</span><br><span class="line">	 <span class="language-xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;user&quot;</span> <span class="attr">id</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">	 	<span class="comment">&lt;!-- id表示查询结果集中唯一标识 </span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 	column：查询出来的列名</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 	property：type指定的pojo类型中的属性名</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 	最终resultMap对column和property作一个映射关系 （对应关系）</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 	--&gt;</span></span></span><br><span class="line"><span class="language-xml">	 	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id_&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">	 	<span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 	result：对普通名映射定义</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 	column：查询出来的列名</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 	property：type指定的pojo类型中的属性名</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 	最终resultMap对column和property作一个映射关系 （对应关系）</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">	 	 --&gt;</span></span></span><br><span class="line"><span class="language-xml">	 	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username_&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">	 </span></span><br><span class="line"><span class="language-xml">	 <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
<li><strong>使用resultMap作为statement的输出映射类型</strong><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 使用resultMap进行输出映射</span><br><span class="line">        resultMap：指定定义的resultMap的id，如果这个resultMap在其它的mapper文件，前边需要加namespace</span><br><span class="line">        --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserByIdResultMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT id id_,username username_ FROM USER WHERE id=#&#123;value&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h4><ul>
<li><p>使用resultType进行输出映射，只有查询出来的列名和pojo中的属性名一致，该列才可以映射成功。</p>
</li>
<li><p>如果查询出来的列名和pojo的属性名不一致，通过定义一个resultMap对列名和pojo属性名之间作一个映射关系。</p>
</li>
</ul>
<h2 id="动态sql-1"><a href="#动态sql-1" class="headerlink" title="动态sql"></a>动态sql</h2><ul>
<li>mybatis核心,对sql语句进行灵活操作，通过表达式进行判断，对sql进行灵活拼接、组装。主要有以下四种：<ul>
<li>if</li>
<li>choose (when, otherwise)</li>
<li>trim (where, set)<br> foreach</li>
</ul>
</li>
</ul>
<h3 id="if判断"><a href="#if判断" class="headerlink" title="if判断"></a>if判断</h3><ul>
<li><strong>mapper.xml</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;findActiveBlogLike&quot;</span></span><br><span class="line">     resultType=<span class="string">&quot;Blog&quot;</span>&gt;</span><br><span class="line">  <span class="variable constant_">SELECT</span> * <span class="variable constant_">FROM</span> <span class="variable constant_">BLOG</span> <span class="variable constant_">WHERE</span> state = ‘<span class="variable constant_">ACTIVE</span>’ </span><br><span class="line">  &lt;<span class="keyword">if</span> test=<span class="string">&quot;title != null&quot;</span>&gt;</span><br><span class="line">    <span class="variable constant_">AND</span> title like #&#123;title&#125;</span><br><span class="line">  &lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">  <span class="language-xml"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    AND author_name like #&#123;author.name&#125;</span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line">&lt;/select&gt;&gt;</span><br></pre></td></tr></table></figure>

<p>有时候在字符串作为判断条件的时候，同时要判断字符串是否为 null 和是否为空</p>
<h3 id="choose-when-otherwise"><a href="#choose-when-otherwise" class="headerlink" title="choose, when, otherwise"></a>choose, when, otherwise</h3><p>有时我们不想应用到所有的条件语句，而只想从中择其一项。针对这种情况，<code>MyBatis</code> 提供了 <strong>choose 元素</strong>，它有点像 Java 中的 switch 语句。</p>
<p>还是上面的例子，但是这次变为提供了“title”就按“title”查找，提供了“author”就按“author”查找的情形，若两者都没有提供，就返回所有符合条件的 <code>BLOG</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;findActiveBlogLike&quot;</span></span><br><span class="line">     resultType=<span class="string">&quot;Blog&quot;</span>&gt;</span><br><span class="line">  <span class="variable constant_">SELECT</span> * <span class="variable constant_">FROM</span> <span class="variable constant_">BLOG</span> <span class="variable constant_">WHERE</span> state = ‘<span class="variable constant_">ACTIVE</span>’</span><br><span class="line">  &lt;choose&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      AND title like #&#123;title&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      AND author_name like #&#123;author.name&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">when</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">      AND featured = 1</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span></span><br><span class="line">  &lt;/choose&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h3 id="trim-where-set"><a href="#trim-where-set" class="headerlink" title="trim, where, set"></a>trim, where, set</h3><p><code>where</code> 和 <code>set</code> 都是 trim 的一种具体做法。</p>
<ul>
<li><code>where 标签的作用</code>：如果该标签包含的元素中有返回值，就插入一个 where ；如果 where后面的字符串是以 AND 和 OR 开头的，就将它们剔除。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;findActiveBlogLike&quot;</span></span><br><span class="line">     resultType=<span class="string">&quot;Blog&quot;</span>&gt;</span><br><span class="line">  <span class="variable constant_">SELECT</span> * <span class="variable constant_">FROM</span> <span class="variable constant_">BLOG</span> </span><br><span class="line">  &lt;where&gt; </span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;state != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">         state = #&#123;state&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span> </span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;title != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        AND title like #&#123;title&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;author != null and author.name != null&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        AND author_name like #&#123;author.name&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line">  &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>set 标签的作用</strong>：</li>
</ul>
<p>如果该标签包含的元素中有返回值，就插入一个 <code>set</code> ；如果 <code>set</code> 后面的字符串是以 逗号 结尾的，就将它们剔除。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;update id=<span class="string">&quot;updateAuthorIfNecessary&quot;</span>&gt;</span><br><span class="line">  update <span class="title class_">Author</span></span><br><span class="line">    &lt;set&gt;</span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;username != null&quot;</span>&gt;</span>username=#&#123;username&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;password != null&quot;</span>&gt;</span>password=#&#123;password&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;email != null&quot;</span>&gt;</span>email=#&#123;email&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line">      <span class="language-xml"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;bio != null&quot;</span>&gt;</span>bio=#&#123;bio&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span></span><br><span class="line">    &lt;/set&gt;</span><br><span class="line">  where id=#&#123;id&#125;</span><br><span class="line">&lt;/update&gt;</span><br></pre></td></tr></table></figure>

<h3 id="foreach标签"><a href="#foreach标签" class="headerlink" title="foreach标签"></a>foreach标签</h3><p><code>动态 SQL</code> 的另外一个常用的操作需求是<strong>对一个集合进行遍历</strong>，通常是在构建 IN 条件语句的时候。向sql传递数组或List，mybatis使用foreach解析</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;selectPostIn&quot;</span> resultType=<span class="string">&quot;domain.blog.Post&quot;</span>&gt;</span><br><span class="line">  <span class="variable constant_">SELECT</span> *</span><br><span class="line">  <span class="variable constant_">FROM</span> <span class="variable constant_">POST</span> P</span><br><span class="line">  <span class="variable constant_">WHERE</span> <span class="variable constant_">ID</span> <span class="keyword">in</span></span><br><span class="line">  &lt;foreach item=<span class="string">&quot;item&quot;</span> index=<span class="string">&quot;index&quot;</span> collection=<span class="string">&quot;list&quot;</span></span><br><span class="line">      open=<span class="string">&quot;(&quot;</span> separator=<span class="string">&quot;,&quot;</span> close=<span class="string">&quot;)&quot;</span>&gt;</span><br><span class="line">        #&#123;item&#125;</span><br><span class="line">  &lt;/foreach&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h2 id="级联"><a href="#级联" class="headerlink" title="级联"></a>级联</h2><h3 id="一对一"><a href="#一对一" class="headerlink" title="一对一"></a>一对一</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> mapper <span class="variable constant_">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.dao.classMapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="comment"><span class="language-xml">		假设老师与班级之间的关系为一对一的关系</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        根据班级id查询班级信息(带老师的信息)</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        SELECT * FROM class c,teacher t WHERE c.teacher_id=t.t_id AND c.c_id=1;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getClass&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ClassResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        select * from class c, teacher t where c.teacher_id=t.t_id and c.c_id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 使用resultMap映射实体类和字段之间的一一对应关系 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;me.gacl.domain.Classes&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ClassResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;c_id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;c_name&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;me.gacl.domain.Teacher&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;t_id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;t_name&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    </span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- </span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    方式二：嵌套查询：通过执行另外一个SQL映射语句来返回预期的复杂类型</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        SELECT * FROM class WHERE c_id=1;</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">        SELECT * FROM teacher WHERE t_id=1   //1 是上一个查询得到的teacher_id的值</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    --&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getClass2&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ClassResultMap2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        select * from class where c_id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="comment">&lt;!-- 使用resultMap映射实体类和字段之间的一一对应关系 --&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;me.gacl.domain.Classes&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ClassResultMap2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;c_id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;c_name&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">column</span>=<span class="string">&quot;teacher_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getTeacher&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     </span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacher&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;me.gacl.domain.Teacher&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT t_id id, t_name name FROM teacher WHERE t_id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="一对多"><a href="#一对多" class="headerlink" title="一对多"></a>一对多</h3><ul>
<li><code>mybatis</code>使用r<strong>esultMap的collection</strong>对关联查询的多条记录映射到一个list集合属性中。</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- </span><br><span class="line">        根据classId查询对应的班级信息,包括学生,老师,班级与老师为一对一，班级与学生为一对多</span><br><span class="line">     --&gt;</span><br><span class="line">    &lt;!-- </span><br><span class="line">    方式一: 嵌套结果: 使用嵌套结果映射来处理重复的联合结果的子集</span><br><span class="line">    <span class="variable constant_">SELECT</span> * <span class="variable constant_">FROM</span> <span class="keyword">class</span> <span class="title class_">c</span>, teacher t,student s <span class="variable constant_">WHERE</span> c.<span class="property">teacher_id</span>=t.<span class="property">t_id</span> <span class="variable constant_">AND</span> c.<span class="property">C_id</span>=s.<span class="property">class_id</span> <span class="variable constant_">AND</span>  c.<span class="property">c_id</span>=<span class="number">1</span></span><br><span class="line">     --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getClass3&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ClassResultMap3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        select * from class c, teacher t,student s where c.teacher_id=t.t_id and c.C_id=s.class_id and  c.c_id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;me.gacl.domain.Classes&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ClassResultMap3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;c_id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;c_name&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">column</span>=<span class="string">&quot;teacher_id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;me.gacl.domain.Teacher&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;t_id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;t_name&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- ofType指定students集合中的对象类型 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;me.gacl.domain.Student&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;s_id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;s_name&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line">    </span><br><span class="line">    &lt;!-- </span><br><span class="line">        方式二：嵌套查询：通过执行另外一个<span class="variable constant_">SQL</span>映射语句来返回预期的复杂类型</span><br><span class="line">            <span class="variable constant_">SELECT</span> * <span class="variable constant_">FROM</span> <span class="keyword">class</span> <span class="title class_">WHERE</span> c_id=<span class="number">1</span>;</span><br><span class="line">            <span class="variable constant_">SELECT</span> * <span class="variable constant_">FROM</span> teacher <span class="variable constant_">WHERE</span> t_id=<span class="number">1</span>   <span class="comment">//1 是上一个查询得到的teacher_id的值</span></span><br><span class="line">            <span class="variable constant_">SELECT</span> * <span class="variable constant_">FROM</span> student <span class="variable constant_">WHERE</span> class_id=<span class="number">1</span>  <span class="comment">//1是第一个查询得到的c_id字段的值</span></span><br><span class="line">     --&gt;</span><br><span class="line">     <span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getClass4&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;ClassResultMap4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        select * from class where c_id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line">     <span class="language-xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;me.gacl.domain.Classes&quot;</span> <span class="attr">id</span>=<span class="string">&quot;ClassResultMap4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;c_id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span> <span class="attr">column</span>=<span class="string">&quot;c_name&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;teacher&quot;</span> <span class="attr">column</span>=<span class="string">&quot;teacher_id&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;me.gacl.domain.Teacher&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getTeacher2&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">association</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;students&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;me.gacl.domain.Student&quot;</span> <span class="attr">column</span>=<span class="string">&quot;c_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;getStudent&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br><span class="line">     </span><br><span class="line">     <span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getTeacher2&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;me.gacl.domain.Teacher&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT t_id id, t_name name FROM teacher WHERE t_id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line">     </span><br><span class="line">     <span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getStudent&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;me.gacl.domain.Student&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT s_id id, s_name name FROM student WHERE class_id=#&#123;id&#125;</span></span><br><span class="line"><span class="language-xml">     <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>另外，下面这篇文章对<strong>一对多的resultMap机制</strong>解释的很清楚：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xzm_rainbow/article/details/15336933">MyBatis：一对多表关系详解(从案例中解析)</a></p>
<h3 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h3><p>将查询用户购买的商品信息明细清单，（用户名、用户地址、购买商品名称、购买商品时间、购买商品数量）</p>
<p>针对上边的需求就使用resultType将查询到的记录映射到一个扩展的pojo中，很简单实现明细清单的功能。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 查询用户及购买的商品 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span> <span class="attr">id</span>=<span class="string">&quot;UserAndItemsResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 用户信息 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;username&quot;</span> <span class="attr">property</span>=<span class="string">&quot;username&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;sex&quot;</span> <span class="attr">property</span>=<span class="string">&quot;sex&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;address&quot;</span> <span class="attr">property</span>=<span class="string">&quot;address&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 订单信息</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    一个用户对应多个订单，使用collection映射</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;ordersList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.iot.mybatis.po.Orders&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;number&quot;</span> <span class="attr">property</span>=<span class="string">&quot;number&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;createtime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createtime&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;note&quot;</span> <span class="attr">property</span>=<span class="string">&quot;note&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 订单明细</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">         一个订单包括 多个明细</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">         --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;orderdetails&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;com.iot.mybatis.po.Orderdetail&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;orderdetail_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;items_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;itemsId&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;items_num&quot;</span> <span class="attr">property</span>=<span class="string">&quot;itemsNum&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;orders_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;ordersId&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">            <span class="comment">&lt;!-- 商品信息</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">             一个订单明细对应一个商品</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">             --&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;items&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.iot.mybatis.po.Items&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;items_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;items_name&quot;</span> <span class="attr">property</span>=<span class="string">&quot;name&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;items_detail&quot;</span> <span class="attr">property</span>=<span class="string">&quot;detail&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;items_price&quot;</span> <span class="attr">property</span>=<span class="string">&quot;price&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="resultMap总结"><a href="#resultMap总结" class="headerlink" title="resultMap总结"></a>resultMap总结</h3><ul>
<li><strong>resultType</strong>  <ul>
<li><p><em><strong>作用</strong></em>：将查询结果按照sql列名pojo属性名一致性映射到pojo中。</p>
</li>
<li><p><em><strong>场合</strong></em>：常见一些明细记录的展示，比如用户购买商品明细，将关联查询信息全部展示在页面时，此时可直接使用resultType将每一条记录映射到pojo中，在前端页面遍历list（list中是pojo）即可。</p>
</li>
</ul>
</li>
<li><strong>resultMap</strong></li>
</ul>
<p>使用association和collection完成一对一和一对多高级映射（对结果有特殊的映射要求）。</p>
<ul>
<li><p><strong>association</strong>：</p>
<ul>
<li><em><strong>作用</strong></em>：将关联查询信息映射到一个pojo对象中。</li>
<li><em><strong>场合</strong></em>：为了方便查询关联信息可以使用association将关联订单信息映射为用户对象的pojo属性中，比如：查询订单及关联用户信息。</li>
</ul>
</li>
</ul>
<p>使用resultType无法将查询结果映射到pojo对象的pojo属性中，根据对结果集查询遍历的需要选择使用resultType还是resultMap。</p>
<ul>
<li><p><strong>collection</strong>：</p>
<ul>
<li><em><strong>作用</strong></em>：将关联查询信息映射到一个list集合中。</li>
<li><em><strong>场合</strong></em>：为了方便查询遍历关联信息可以使用collection将关联信息映射到list集合中，比如：查询用户权限范围模块及模块下的菜单，可使用collection将模块映射到模块list中，将菜单列表映射到模块对象的菜单list属性中，这样的作的目的也是方便对查询结果集进行遍历查询。如果使用resultType无法将查询结果映射到list集合中。</li>
</ul>
</li>
</ul>
<h2 id="延迟加载"><a href="#延迟加载" class="headerlink" title="延迟加载"></a>延迟加载</h2><p><strong>resultMap</strong>可以实现高级映射（使用association、collection实现一对一及一对多映射），association、collection具备延迟加载功能。</p>
<p><code>延迟加载</code>：先从单表查询、需要时再从关联表去关联查询，大大提高数据库性能，因为查询单表要比关联查询多张表速度要快。</p>
<p><em><strong>需求：</strong></em></p>
<p>如果查询订单并且关联查询用户信息。如果先查询订单信息即可满足要求，当我们需要查询用户信息时再查询用户信息。把对用户信息的按需去查询就是延迟加载。</p>
<h3 id="使用association实现延迟加载"><a href="#使用association实现延迟加载" class="headerlink" title="使用association实现延迟加载"></a>使用association实现延迟加载</h3><ul>
<li><strong>mapper.xml</strong><br>需要定义两个mapper的方法对应的statement。</li>
</ul>
<ol>
<li>只查询订单信息<br><code>SELECT * FROM orders</code></li>
</ol>
<ul>
<li>在查询订单的statement中使用association去延迟加载（执行）下边的satatement(关联查询用户信息)<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 查询订单关联查询用户，用户信息需要延迟加载 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findOrdersUserLazyLoading&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;OrdersUserLazyLoadingResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    SELECT * FROM orders</span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="2">
<li>关联查询用户信息</li>
</ol>
<ul>
<li><p>通过上边查询到的订单信息中<code>user_id</code>去关联查询用户信息,使用UserMapper.xml中的<code>findUserById</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;findUserById&quot;</span> parameterType=<span class="string">&quot;int&quot;</span> resultType=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span>&gt;</span><br><span class="line">    <span class="variable constant_">SELECT</span> * <span class="variable constant_">FROM</span>  user  <span class="variable constant_">WHERE</span> id=#&#123;value&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>
<p>上边先去执行<code>findOrdersUserLazyLoading</code>，当需要去查询用户的时候再去执行<code>findUserById</code>，通过<code>resultMap</code>的定义将延迟加载执行配置起来。</p>
</li>
<li><p><strong>延迟加载resultMap</strong></p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 延迟加载的resultMap --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">&quot;com.iot.mybatis.po.Orders&quot;</span> <span class="attr">id</span>=<span class="string">&quot;OrdersUserLazyLoadingResultMap&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--对订单信息进行映射配置  --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userId&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;number&quot;</span> <span class="attr">property</span>=<span class="string">&quot;number&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;createtime&quot;</span> <span class="attr">property</span>=<span class="string">&quot;createtime&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;note&quot;</span> <span class="attr">property</span>=<span class="string">&quot;note&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 实现对用户信息进行延迟加载</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    select：指定延迟加载需要执行的statement的id（是根据user_id查询用户信息的statement）</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    要使用userMapper.xml中findUserById完成根据用户id(user_id)用户信息的查询，如果findUserById不在本mapper中需要前边加namespace</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    column：订单信息中关联用户信息查询的列，是user_id</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    关联查询的sql理解为：</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    SELECT orders.*,</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    (SELECT username FROM USER WHERE orders.user_id = user.id)username,</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    (SELECT sex FROM USER WHERE orders.user_id = user.id)sex</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     FROM orders</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;user&quot;</span>  <span class="attr">javaType</span>=<span class="string">&quot;com.iot.mybatis.po.User&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                 <span class="attr">select</span>=<span class="string">&quot;com.iot.mybatis.mapper.UserMapper.findUserById&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">                 <span class="attr">column</span>=<span class="string">&quot;user_id&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">     <span class="comment">&lt;!-- 实现对用户信息进行延迟加载 --&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>与非延迟加载的<strong>主要区别</strong>就在<code>association</code>标签属性多了<code>select</code>和<code>column</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;association property=&quot;user&quot;  javaType=&quot;com.iot.mybatis.po.User&quot;</span><br><span class="line">             select=&quot;com.iot.mybatis.mapper.UserMapper.findUserById&quot;</span><br><span class="line">             column=&quot;user_id&quot;&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>mapper.java</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//查询订单关联查询用户，用户信息是延迟加载</span><br><span class="line">public List&lt;Orders&gt; findOrdersUserLazyLoading()throws Exception;</span><br></pre></td></tr></table></figure></li>
<li><strong>延迟加载配置</strong></li>
</ul>
<p>mybatis默认没有开启延迟加载，需要在SqlMapConfig.xml中setting配置。  </p>
<p>在<strong>mybatis核心配置文件</strong>中配置：<code>lazyLoadingEnabled</code>、<code>aggressiveLazyLoading</code></p>
<table>
<thead>
<tr>
<th align="center">设置项</th>
<th align="center">描述</th>
<th align="center">允许值</th>
<th align="center">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="center">lazyLoadingEnabled</td>
<td align="center">全局性设置懒加载。如果设为‘false’，则所有相关联的都会被初始化加载</td>
<td align="center">true&#x2F;false</td>
<td align="center">false</td>
</tr>
<tr>
<td align="center">aggressiveLazyLoading</td>
<td align="center">当设置为‘true’的时候，懒加载的对象可能被任何懒属性全部加载。否则，每个属性都按需加载。</td>
<td align="center">true&#x2F;false</td>
<td align="center">true</td>
</tr>
</tbody></table>
<ul>
<li>在SqlMapConfig.xml中配置：<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">    &lt;!-- 打开延迟加载 的开关 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span></span><br><span class="line">    &lt;!-- 将积极加载改为消极加载即按需要加载 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span></span><br><span class="line">    &lt;!-- 开启二级缓存 --&gt;</span><br><span class="line">   &lt;!-- <span class="language-xml"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span>--&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="延迟加载思考"><a href="#延迟加载思考" class="headerlink" title="延迟加载思考"></a>延迟加载思考</h3><blockquote>
<p>不使用mybatis提供的association及collection中的延迟加载功能，如何实现延迟加载？  <strong>实现方法如下</strong>：</p>
</blockquote>
<ul>
<li><p><strong>定义两个mapper方法</strong>：</p>
<ol>
<li>查询订单列表</li>
<li>根据用户id查询用户信息</li>
</ol>
</li>
<li><p><strong>实现思路</strong>：</p>
</li>
</ul>
<p>先去查询第一个mapper方法，获取订单信息列表；在程序中（service），按需去调用第二个mapper方法去查询用户信息。</p>
<p>总之，使用延迟加载方法，先去查询简单的sql（最好单表，也可以关联查询），再去按需要加载关联查询的其它信息。</p>
<h2 id="Mybatis-缓存机制分析-一级缓存与二级缓存"><a href="#Mybatis-缓存机制分析-一级缓存与二级缓存" class="headerlink" title="Mybatis 缓存机制分析-一级缓存与二级缓存"></a>Mybatis 缓存机制分析-一级缓存与二级缓存</h2><p> <a target="_blank" rel="noopener" href="https://tech.meituan.com/2018/01/19/mybatis-cache.html">聊聊MyBatis缓存机制</a></p>
<h2 id="spring和mybatis整合"><a href="#spring和mybatis整合" class="headerlink" title="spring和mybatis整合"></a>spring和mybatis整合</h2><p>本文主要将如何将spring和mybatis整合，只是作简单的示例，没有使用Maven构建。并展示mybatis与spring整合后如何进行原始dao开发和mapper代理开发。</p>
<h3 id="整合思路"><a href="#整合思路" class="headerlink" title="整合思路"></a>整合思路</h3><ul>
<li>需要spring通过单例方式管理<code>SqlSessionFactory</code>。</li>
<li>spring和mybatis整合生成代理对象，使用SqlSessionFactory创建<code>SqlSession</code>。（spring和mybatis整合自动完成）</li>
<li>持久层的<code>mapper</code>都需要由spring进行管理。</li>
</ul>
<h3 id="整合环境"><a href="#整合环境" class="headerlink" title="整合环境"></a>整合环境</h3><p>创建一个新的java工程（接近实际开发的工程结构）</p>
<p>jar包：</p>
<ul>
<li>mybatis3.2.7的jar包</li>
<li>spring3.2.0的jar包</li>
<li>mybatis和spring的整合包：早期ibatis和spring整合是由spring官方提供，mybatis和spring整合由mybatis提供。</li>
</ul>
<h3 id="sqlSessionFactory"><a href="#sqlSessionFactory" class="headerlink" title="sqlSessionFactory"></a>sqlSessionFactory</h3><ul>
<li>在<code>applicationContext.xml</code>配置<code>sqlSessionFactory</code>和<code>数据源</code></li>
<li><code>sqlSessionFactory</code>在mybatis和spring的整合包下。<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       <span class="attr">xmlns</span>:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span> <span class="attr">xmlns</span>:mvc=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span><br><span class="line">       <span class="attr">xmlns</span>:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       <span class="attr">xmlns</span>:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span> <span class="attr">xmlns</span>:tx=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span><br><span class="line">       <span class="attr">xsi</span>:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">		http://www.springframework.org/schema/beans/spring-beans-3.2.xsd</span></span><br><span class="line"><span class="string">		http://www.springframework.org/schema/mvc</span></span><br><span class="line"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd</span></span><br><span class="line"><span class="string">		http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">		http://www.springframework.org/schema/context/spring-context-3.2.xsd</span></span><br><span class="line"><span class="string">		http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">		http://www.springframework.org/schema/aop/spring-aop-3.2.xsd</span></span><br><span class="line"><span class="string">		http://www.springframework.org/schema/tx</span></span><br><span class="line"><span class="string">		http://www.springframework.org/schema/tx/spring-tx-3.2.xsd &quot;</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;!-- 加载配置文件 --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:db.properties&quot;</span> /&gt;</span></span></span><br><span class="line"></span><br><span class="line">    &lt;!-- 数据源，使用dbcp --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span></span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          <span class="attr">destroy-method</span>=<span class="string">&quot;close&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.username&#125;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;5&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line"></span><br><span class="line">    &lt;!-- sqlSessinFactory --&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 加载mybatis的配置文件 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;mybatis/SqlMapConfig.xml&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!-- 数据源 --&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="原始dao开发-和spring整合后"><a href="#原始dao开发-和spring整合后" class="headerlink" title="原始dao开发(和spring整合后)"></a>原始dao开发(和spring整合后)</h3><ul>
<li><p><strong>User.xml</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> mapper</span><br><span class="line">        <span class="variable constant_">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;!-- namespace 命名空间，作用就是对sql进行分类化管理,理解为sql隔离</span><br><span class="line"> 注意：使用mapper代理方法开发，namespace有特殊重要的作用</span><br><span class="line"> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;test&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 在映射文件中配置很多sql语句 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--需求:通过id查询用户表的记录 --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 通过select执行数据库查询</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     id:标识映射文件中的sql，称为statement的id</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     将sql语句封装到mappedStatement对象中，所以将id称为statement的id</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     parameterType:指定输入参数的类型</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     #&#123;&#125;标示一个占位符,</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     #&#123;value&#125;其中value表示接收输入参数的名称，如果输入参数是简单类型，那么#&#123;&#125;中的值可以任意。</span></span></span><br><span class="line"><span class="comment"><span class="language-xml"></span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     resultType：指定sql输出结果的映射的java对象类型，select指定resultType表示将单条记录映射成java对象</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">     --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.iot.ssm.po.User&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT * FROM  user  WHERE id=#&#123;value&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>在SqlMapconfig.xml中加载User.xml</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!-- 加载映射文件--&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;sqlmap/User.xml&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span>  </span><br></pre></td></tr></table></figure>
</li>
<li><p>dao(实现类继承SqlSessionDaoSupport)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">    <span class="comment">//根据id查询用户信息</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>dao接口实现类</strong>需要注入<code>SqlSessoinFactory</code>，通过spring进行注入。这里spring声明配置方式，配置dao的bean</p>
<ul>
<li><p><strong>让UserDaoImpl实现类继承SqlSessionDaoSupport</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">extends</span> <span class="title class_">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findUserById</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">//继承SqlSessionDaoSupport，通过this.getSqlSession()得到sqlSessoin</span></span><br><span class="line">        <span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> <span class="built_in">this</span>.getSqlSession();</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> sqlSession.selectOne(<span class="string">&quot;test.findUserById&quot;</span>,id);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>配置dao</strong></p>
</li>
</ul>
<p>在<code>applicationContext.xml</code>中配置<code>dao</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 原始dao接口 --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userDao&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.iot.ssm.dao.UserDaoImpl&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<h3 id="mapper代理开发"><a href="#mapper代理开发" class="headerlink" title="mapper代理开发"></a>mapper代理开发</h3><ul>
<li><p><strong>mapper.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    <span class="comment">//根据id查询用户信息</span></span><br><span class="line">    User <span class="title function_">findUserById</span><span class="params">(<span class="type">int</span> id)</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>mapper.xml</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span> ?&gt;</span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> mapper</span><br><span class="line">        <span class="variable constant_">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span><br><span class="line">        <span class="string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span><br><span class="line">&lt;!--</span><br><span class="line"> namespace 命名空间，作用就是对sql进行分类化管理,理解为sql隔离</span><br><span class="line"> 注意：使用mapper代理方法开发，namespace有特殊重要的作用</span><br><span class="line"> --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.iot.ssm.mapper.UserMapper&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 在映射文件中配置很多sql语句 --&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;findUserById&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;int&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        SELECT * FROM  user  WHERE id=#&#123;value&#125;</span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
</li>
<li><p>通过MapperFactoryBean创建代理对象</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!-- mapper配置</span><br><span class="line">    <span class="title class_">MapperFactoryBean</span>：根据mapper接口生成代理对象</span><br><span class="line">    --&gt;</span><br><span class="line"></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userMapper&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperFactoryBean&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        //mapperInterface指定mapper接口</span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperInterface&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.iot.ssm.mapper.UserMapper&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>此方法问题：需要针对每个<code>mapper</code>进行配置，麻烦。</p>
<ul>
<li>通过<code>MapperScannerConfigurer</code>进行整个 <code>mapper</code> 包进行扫描（建议使用）<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- mapper批量扫描，从mapper包中扫描出mapper接口，自动创建代理对象并且在spring容器中注册</span><br><span class="line">    遵循规范：将mapper.<span class="property">java</span>和mapper.<span class="property">xml</span>映射文件名称保持一致，且在一个目录 中</span><br><span class="line">    自动扫描出来的mapper的bean的id为mapper类名（首字母小写）</span><br><span class="line">    --&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 指定扫描的包名</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    如果扫描多个包，每个包中间使用半角逗号分隔</span></span></span><br><span class="line"><span class="comment"><span class="language-xml">    --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.iot.ssm.mapper&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactoryBeanName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span></span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="mybatis逆向工程"><a href="#mybatis逆向工程" class="headerlink" title="mybatis逆向工程"></a>mybatis逆向工程</h2><p>mybaits需要程序员自己编写sql语句,mybatis官方提供逆向工程,可以针对单表自动生成mybatis执行所需要的代码（mapper.java,mapper.xml、po…）</p>
<p>企业实际开发中，常用的逆向工程方式：由数据库的表生成java代码。</p>
<p>先附上官网链接：<a target="_blank" rel="noopener" href="http://mybatis.org/generator/">MyBatis Generator</a></p>
<ul>
<li><strong>逆向工程配置文件</strong></li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> generatorConfiguration</span><br><span class="line">  <span class="variable constant_">PUBLIC</span> <span class="string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span><br><span class="line">  <span class="string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!--数据库驱动,最好不要有中文字符,不然会找不到--&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">classPathEntry</span> <span class="attr">location</span>=<span class="string">&quot;F:/cache/mysql-connector-java-5.1.28-bin.jar&quot;</span> /&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;DB2Tables&quot;</span>    <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressDate&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--数据库链接地址账号密码--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span> <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost/test&quot;</span> <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span> <span class="attr">password</span>=<span class="string">&quot;&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--生成Model类存放位置--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.leige.domain&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--生成映射文件存放位置--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.leige.domain&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--生成DaoMapper类存放位置--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.leige.dao&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="comment">&lt;!--生成对应表及类名,需要记住的一点是逆向工程无法生成关联关系,只能生成单表操作--&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;student&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">domainObjectName</span>=<span class="string">&quot;Student&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">           <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;teacher&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">            <span class="attr">domainObjectName</span>=<span class="string">&quot;Teacher&quot;</span> </span></span></span><br><span class="line"><span class="tag"><span class="language-xml">          &gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Java 程序</strong><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.leige.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.geom.GeneralPath;</span><br><span class="line"><span class="keyword">import</span> java.awt.im.InputContext;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStream;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.ibatis.io.Resources;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.chainsaw.Main;</span><br><span class="line"><span class="keyword">import</span> org.apache.log4j.lf5.util.Resource;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.api.MyBatisGenerator;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.config.xml.ConfigurationParser;</span><br><span class="line"><span class="keyword">import</span> org.mybatis.generator.internal.DefaultShellCallback;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MybatisGen</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">generator</span><span class="params">()</span> <span class="keyword">throws</span> Exception&#123;</span><br><span class="line">           List&lt;String&gt; warnings = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">           <span class="type">boolean</span> <span class="variable">overwrite</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">           <span class="comment">//项目根路径不要有中文,我的有中文,所以使用绝对路径</span></span><br><span class="line">           <span class="type">File</span> <span class="variable">configFile</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;F:/cache/generatorConfig.xml&quot;</span>);</span><br><span class="line">           <span class="type">ConfigurationParser</span> <span class="variable">cp</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationParser</span>(warnings);</span><br><span class="line">           <span class="type">Configuration</span> <span class="variable">config</span> <span class="operator">=</span> cp.parseConfiguration(configFile);</span><br><span class="line">           <span class="type">DefaultShellCallback</span> <span class="variable">callback</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultShellCallback</span>(overwrite);</span><br><span class="line">           <span class="type">MyBatisGenerator</span> <span class="variable">myBatisGenerator</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyBatisGenerator</span>(config, callback, warnings);</span><br><span class="line">           myBatisGenerator.generate(<span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            generator();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag"><i class="fa fa-tag"></i> 学习</a>
              <a href="/tags/Java/" rel="tag"><i class="fa fa-tag"></i> Java</a>
              <a href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag"><i class="fa fa-tag"></i> 工具</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/03/04/Maven%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" rel="prev" title="Maven学习笔记">
      <i class="fa fa-chevron-left"></i> Maven学习笔记
    </a></div>
      <div class="post-nav-item">
    <a href="/2022/03/04/mysql%E5%9F%BA%E7%A1%80%EF%BC%88%E4%BA%8C%EF%BC%89/" rel="next" title="MySQL基础（二）">
      MySQL基础（二） <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#MyBatis"><span class="nav-number">1.</span> <span class="nav-text">MyBatis</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AF%B9%E5%8E%9F%E7%94%9Fjdbc%E7%A8%8B%E5%BA%8F%E4%B8%AD%E7%9A%84%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93"><span class="nav-number">1.1.</span> <span class="nav-text">对原生jdbc程序中的问题总结</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#jdbc%E7%BC%96%E7%A8%8B%E6%AD%A5%E9%AA%A4"><span class="nav-number">1.1.1.</span> <span class="nav-text">jdbc编程步骤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93"><span class="nav-number">1.1.2.</span> <span class="nav-text">问题总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E4%BB%A3%E7%A0%81"><span class="nav-number">1.1.3.</span> <span class="nav-text">参考代码</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#JDBC-%E5%90%91-Mybatis-%E7%9A%84%E8%BD%AC%E5%8C%96"><span class="nav-number">1.1.4.</span> <span class="nav-text">JDBC 向 Mybatis 的转化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%BF%9E%E6%8E%A5%E8%8E%B7%E5%8F%96%E5%92%8C%E9%87%8A%E6%94%BE"><span class="nav-number">1.1.4.1.</span> <span class="nav-text">数据库的连接获取和释放</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SQL-%E7%9A%84%E7%BB%9F%E4%B8%80%E5%AD%98%E5%8F%96"><span class="nav-number">1.1.4.2.</span> <span class="nav-text">SQL 的统一存取</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%A0%E5%85%A5%E5%8F%82%E6%95%B0%E6%98%A0%E5%B0%84%E5%92%8C%E5%8A%A8%E6%80%81SQL"><span class="nav-number">1.1.4.3.</span> <span class="nav-text">传入参数映射和动态SQL</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%93%E6%9E%9C%E6%98%A0%E5%B0%84%E5%92%8C%E7%BB%93%E6%9E%9C%E7%BC%93%E5%AD%98"><span class="nav-number">1.1.4.4.</span> <span class="nav-text">结果映射和结果缓存</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E9%87%8D%E5%A4%8DSQL%E8%AF%AD%E5%8F%A5%E9%97%AE%E9%A2%98"><span class="nav-number">1.1.4.5.</span> <span class="nav-text">解决重复SQL语句问题</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MyBatis%E6%A6%82%E8%BF%B0"><span class="nav-number">1.2.</span> <span class="nav-text">MyBatis概述</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#MyBatis%E4%BB%8B%E7%BB%8D"><span class="nav-number">1.2.1.</span> <span class="nav-text">MyBatis介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%86%E6%9E%B6%E5%8E%9F%E7%90%86"><span class="nav-number">1.2.2.</span> <span class="nav-text">框架原理</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mybatis%E6%A1%86%E6%9E%B6%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B"><span class="nav-number">1.2.3.</span> <span class="nav-text">mybatis框架执行过程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mybatis%E5%BC%80%E5%8F%91dao%E7%9A%84%E6%96%B9%E6%B3%95"><span class="nav-number">1.2.4.</span> <span class="nav-text">mybatis开发dao的方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%98%A0%E5%B0%84%E5%92%8C%E8%BE%93%E5%87%BA%E6%98%A0%E5%B0%84"><span class="nav-number">1.2.5.</span> <span class="nav-text">输入映射和输出映射</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8A%A8%E6%80%81sql"><span class="nav-number">1.2.6.</span> <span class="nav-text">动态sql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mybatis%E5%92%8Chibernate%E6%9C%AC%E8%B4%A8%E5%8C%BA%E5%88%AB%E5%92%8C%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">1.2.7.</span> <span class="nav-text">mybatis和hibernate本质区别和应用场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F"><span class="nav-number">1.3.</span> <span class="nav-text">入门程序</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F%EF%BC%88%E4%B8%80%EF%BC%89"><span class="nav-number">1.3.1.</span> <span class="nav-text">入门程序（一）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E7%A8%8B%E7%BB%93%E6%9E%84"><span class="nav-number">1.3.1.1.</span> <span class="nav-text">工程结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6"><span class="nav-number">1.3.1.2.</span> <span class="nav-text">映射文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81"><span class="nav-number">1.3.1.3.</span> <span class="nav-text">程序代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">1.3.1.4.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%A5%E9%97%A8%E7%A8%8B%E5%BA%8F%E4%BA%8C"><span class="nav-number">1.3.2.</span> <span class="nav-text">入门程序二</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%98%A0%E5%B0%84%E6%96%87%E4%BB%B6-1"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">映射文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%A8%8B%E5%BA%8F%E4%BB%A3%E7%A0%81-1"><span class="nav-number">1.3.2.2.</span> <span class="nav-text">程序代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-1"><span class="nav-number">1.3.2.3.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%80%E5%8F%91DAO%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.</span> <span class="nav-text">开发DAO方法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SqlSession%E4%BD%BF%E7%94%A8%E8%8C%83%E5%9B%B4"><span class="nav-number">1.4.1.</span> <span class="nav-text">SqlSession使用范围</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%A7%8Bdao%E5%BC%80%E5%8F%91%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.2.</span> <span class="nav-text">原始dao开发方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mapper%E4%BB%A3%E7%90%86%E6%96%B9%E6%B3%95"><span class="nav-number">1.4.3.</span> <span class="nav-text">mapper代理方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">开发规范</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E9%97%AE%E9%A2%98%E6%80%BB%E7%BB%93"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">一些问题总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-number">1.5.</span> <span class="nav-text">配置文件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#properties-%E5%B1%9E%E6%80%A7"><span class="nav-number">1.5.1.</span> <span class="nav-text">properties(属性)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#settings-%E5%85%A8%E5%B1%80%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.2.</span> <span class="nav-text">settings(全局参数配置)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#typeAliases-%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D"><span class="nav-number">1.5.3.</span> <span class="nav-text">typeAliases(类型别名)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#typeHandlers-%E7%B1%BB%E5%9E%8B%E5%A4%84%E7%90%86%E5%99%A8"><span class="nav-number">1.5.4.</span> <span class="nav-text">typeHandlers(类型处理器)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mappers-%E6%98%A0%E5%B0%84%E9%85%8D%E7%BD%AE"><span class="nav-number">1.5.5.</span> <span class="nav-text">mappers(映射配置)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sql%E7%89%87%E6%AE%B5-%E9%87%8D%E7%82%B9"><span class="nav-number">1.5.6.</span> <span class="nav-text">sql片段(重点)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%85%A5%E6%98%A0%E5%B0%84"><span class="nav-number">1.6.</span> <span class="nav-text">输入映射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.6.1.</span> <span class="nav-text">基本数据类型示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Map-%E7%B1%BB%E5%9E%8B%E4%BC%A0%E5%85%A5%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.6.2.</span> <span class="nav-text">Map 类型传入示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Pojo-%E4%BC%A0%E5%85%A5%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.6.3.</span> <span class="nav-text">Pojo 传入示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%BE%93%E5%87%BA%E6%98%A0%E5%B0%84"><span class="nav-number">1.7.</span> <span class="nav-text">输出映射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#resultType"><span class="nav-number">1.7.1.</span> <span class="nav-text">resultType</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%A4%BA%E4%BE%8B"><span class="nav-number">1.7.2.</span> <span class="nav-text">简单示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resultMap"><span class="nav-number">1.7.3.</span> <span class="nav-text">resultMap</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resultMap%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95"><span class="nav-number">1.7.4.</span> <span class="nav-text">resultMap使用方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">1.7.4.1.</span> <span class="nav-text">小结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8A%A8%E6%80%81sql-1"><span class="nav-number">1.8.</span> <span class="nav-text">动态sql</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#if%E5%88%A4%E6%96%AD"><span class="nav-number">1.8.1.</span> <span class="nav-text">if判断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#choose-when-otherwise"><span class="nav-number">1.8.2.</span> <span class="nav-text">choose, when, otherwise</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#trim-where-set"><span class="nav-number">1.8.3.</span> <span class="nav-text">trim, where, set</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#foreach%E6%A0%87%E7%AD%BE"><span class="nav-number">1.8.4.</span> <span class="nav-text">foreach标签</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BA%A7%E8%81%94"><span class="nav-number">1.9.</span> <span class="nav-text">级联</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%AF%B9%E4%B8%80"><span class="nav-number">1.9.1.</span> <span class="nav-text">一对一</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E5%AF%B9%E5%A4%9A"><span class="nav-number">1.9.2.</span> <span class="nav-text">一对多</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%9A%E5%AF%B9%E5%A4%9A"><span class="nav-number">1.9.3.</span> <span class="nav-text">多对多</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#resultMap%E6%80%BB%E7%BB%93"><span class="nav-number">1.9.4.</span> <span class="nav-text">resultMap总结</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="nav-number">1.10.</span> <span class="nav-text">延迟加载</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8association%E5%AE%9E%E7%8E%B0%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="nav-number">1.10.1.</span> <span class="nav-text">使用association实现延迟加载</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD%E6%80%9D%E8%80%83"><span class="nav-number">1.10.2.</span> <span class="nav-text">延迟加载思考</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Mybatis-%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%E5%88%86%E6%9E%90-%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E4%B8%8E%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="nav-number">1.11.</span> <span class="nav-text">Mybatis 缓存机制分析-一级缓存与二级缓存</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#spring%E5%92%8Cmybatis%E6%95%B4%E5%90%88"><span class="nav-number">1.12.</span> <span class="nav-text">spring和mybatis整合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E5%90%88%E6%80%9D%E8%B7%AF"><span class="nav-number">1.12.1.</span> <span class="nav-text">整合思路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B4%E5%90%88%E7%8E%AF%E5%A2%83"><span class="nav-number">1.12.2.</span> <span class="nav-text">整合环境</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#sqlSessionFactory"><span class="nav-number">1.12.3.</span> <span class="nav-text">sqlSessionFactory</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%A7%8Bdao%E5%BC%80%E5%8F%91-%E5%92%8Cspring%E6%95%B4%E5%90%88%E5%90%8E"><span class="nav-number">1.12.4.</span> <span class="nav-text">原始dao开发(和spring整合后)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mapper%E4%BB%A3%E7%90%86%E5%BC%80%E5%8F%91"><span class="nav-number">1.12.5.</span> <span class="nav-text">mapper代理开发</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B"><span class="nav-number">1.13.</span> <span class="nav-text">mybatis逆向工程</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="aeowind"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">aeowind</p>
  <div class="site-description" itemprop="description">爱上一场认真的消遣</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">55</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">28</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/aeowind" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;aeowind" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.douban.com/people/129971630/" title="douban → https:&#x2F;&#x2F;www.douban.com&#x2F;people&#x2F;129971630&#x2F;" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>douban</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">aeowind</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>

<!-- 页面点击小红心 -->

      <script type="text/javascript" src="/js/clicklove.js"></script>

